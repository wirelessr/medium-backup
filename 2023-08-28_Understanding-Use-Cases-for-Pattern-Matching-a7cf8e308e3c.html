<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Understanding Use Cases for Pattern Matching</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Understanding Use Cases for Pattern Matching</h1>
</header>
<section data-field="subtitle" class="p-summary">
Explaining Python 3.10’s new features with real-world examples
</section>
<section data-field="body" class="e-content">
<section name="1844" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="386b" id="386b" class="graf graf--h3 graf--leading graf--title">Understanding Use Cases for Pattern Matching</h3><h4 name="327d" id="327d" class="graf graf--h4 graf-after--h3 graf--subtitle">Explaining Python 3.10’s new features with real-world examples</h4><figure name="683a" id="683a" class="graf graf--figure graf-after--h4"><img class="graf-image" data-image-id="0*2onJlgsVc4rtqLPE" data-width="1000" data-height="750" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/0*2onJlgsVc4rtqLPE"><figcaption class="imageCaption">Photo by <a href="https://unsplash.com/@aridley88" data-href="https://unsplash.com/@aridley88" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank">Andrew Ridley</a> on <a href="https://unsplash.com/photos/jR4Zf-riEjI" data-href="https://unsplash.com/photos/jR4Zf-riEjI" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank">Unsplash</a></figcaption></figure><p name="8c51" id="8c51" class="graf graf--p graf-after--figure">Pattern matching has finally been supported in Python since 3.10, and this feature, which is common to many functional programming languages, has been painlessly ported to Python.</p><p name="ff18" id="ff18" class="graf graf--p graf-after--p">However, for those of us who are new to pattern matching, it’s hard for us to figure out the right use cases and thus the code we write is not much different from an <code class="markup--code markup--p-code">if-else</code>, with at most a little more syntactic sugar in the <code class="markup--code markup--p-code">if-else</code> to allow for more fine-grained definitions of the variables.</p><p name="9481" id="9481" class="graf graf--p graf-after--p">To understand the real use case of pattern matching, we have to review the paragraph in <a href="https://peps.python.org/pep-0635/#rationale" data-href="https://peps.python.org/pep-0635/#rationale" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">PEP 635</a>.</p><blockquote name="4e72" id="4e72" class="graf graf--blockquote graf-after--p"><em class="markup--em markup--blockquote-em">Much of the power of pattern matching comes from the nesting of subpatterns. That the success of a pattern match depends directly on the success of subpattern is thus a cornerstone of the design.</em></blockquote><p name="09bc" id="09bc" class="graf graf--p graf-after--blockquote"><strong class="markup--strong markup--p-strong">Nesting of subpatterns</strong> sounds a bit abstract, what are some practical examples of this property?</p><p name="725a" id="725a" class="graf graf--p graf-after--p">The easiest data structure to understand is the tree.</p><p name="4115" id="4115" class="graf graf--p graf-after--p">Taking a binary tree as an example, traversing from the top to the bottom, each node actually satisfies the following properties.</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="python" name="3ce0" id="3ce0" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">class</span> <span class="hljs-title class_">TreeNode</span>:<br />    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, value</span>):<br />        self.value = value<br />        self.left = <span class="hljs-literal">None</span><br />        self.right = <span class="hljs-literal">None</span></span></pre><p name="9e39" id="9e39" class="graf graf--p graf-after--pre">Each node will have an attribute of its own, as well as a child to the left and right, and this is the typical nested structure. Therefore, one of the most practical examples is to look for tree nodes that match the pattern.</p><h3 name="d8e0" id="d8e0" class="graf graf--h3 graf-after--p">AST Tree</h3><p name="94b6" id="94b6" class="graf graf--p graf-after--h3">AST tree is a very common method used for lint or syntax checking.</p><p name="1f8b" id="1f8b" class="graf graf--p graf-after--p">Suppose we have a requirement to check whether a source code has a direct call to <code class="markup--code markup--p-code">print</code>, then we can use <code class="markup--code markup--p-code">if</code> to compare the conditions and find out if the node that matches the condition violates the lint rule.</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="python" name="43b1" id="43b1" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">for</span> node <span class="hljs-keyword">in</span> ast.walk(tree):<br />    <span class="hljs-keyword">if</span> (<br />        <span class="hljs-built_in">isinstance</span>(node, ast.Call)  <span class="hljs-comment"># It&#x27;s a call</span><br />        <span class="hljs-keyword">and</span> <span class="hljs-built_in">isinstance</span>(node.func, ast.Name)  <span class="hljs-comment"># It directly invokes a name</span><br />        <span class="hljs-keyword">and</span> node.func.<span class="hljs-built_in">id</span> == <span class="hljs-string">&#x27;print&#x27;</span>  <span class="hljs-comment"># That name is `print`</span><br />    ):<br />        sys.exit(<span class="hljs-number">0</span>)<br />        <br />sys.exit(<span class="hljs-number">1</span>)</span></pre><p name="3490" id="3490" class="graf graf--p graf-after--pre">From the above code we know we want to match a node <code class="markup--code markup--p-code">ast.Call</code> and it is a call function and the function name is print, three conditions in total.</p><p name="c700" id="c700" class="graf graf--p graf-after--p">Now, we know the pattern conditions we want to compare, let’s rewrite it as follows using pattern matching.</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="python" name="8318" id="8318" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">for</span> node <span class="hljs-keyword">in</span> ast.walk(tree):<br />    <span class="hljs-keyword">match</span> node:<br />        <span class="hljs-comment"># If it&#x27;s a call to `print`</span><br />        <span class="hljs-keyword">case</span> ast.Call(func=ast.Name(<span class="hljs-built_in">id</span>=<span class="hljs-string">&#x27;print&#x27;</span>)):<br />            sys.exit(<span class="hljs-number">0</span>)<br />            <br />sys.exit(<span class="hljs-number">1</span>)</span></pre><p name="057e" id="057e" class="graf graf--p graf-after--pre">With pattern matching, we can make the conditions more straightforward by comparing them to the <code class="markup--code markup--p-code">class</code> definition we have in our head.</p><p name="00cf" id="00cf" class="graf graf--p graf-after--p">From the code we can see pattern matching makes comparing conditions simple, but that’s not the power of pattern matching, because we haven’t compared nested structures yet. Let’s look at the next example.</p><h3 name="5ec6" id="5ec6" class="graf graf--h3 graf-after--p">Parsing Tree</h3><p name="43e0" id="43e0" class="graf graf--p graf-after--h3">Suppose now I want to find some Patterns on a binary tree with various colors and shapes.</p><p name="7f52" id="7f52" class="graf graf--p graf-after--p">Given a tree of this kind, I want to know:</p><ul class="postList"><li name="9c6b" id="9c6b" class="graf graf--li graf-after--p">Is there a green square on the tree with a red circle attached to the left node?</li><li name="a69c" id="a69c" class="graf graf--li graf-after--li">Does the tree have any shape of any color, with a yellow triangle attached to the left node and a blue rectangle attached to the right node?</li><li name="cdec" id="cdec" class="graf graf--li graf-after--li">The tree has a yellow circle with a blue rectangle attached to the left node. For the blue rectangle, the left node is connected to a red triangle, and the right node is connected to a red rectangle. The red rectangle, the right node is connected to the green square.</li></ul><p name="07a4" id="07a4" class="graf graf--p graf-after--li">Then our thinking model would look like the following diagram.</p><figure name="7fab" id="7fab" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="0*2jQ8GdzTxES3sRZf.png" data-width="1920" data-height="1008" src="https://cdn-images-1.medium.com/max/800/0*2jQ8GdzTxES3sRZf.png"></figure><p name="53d1" id="53d1" class="graf graf--p graf-after--figure">Actually, that’s all our program has to do.</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="python" name="2a7a" id="2a7a" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">def</span> <span class="hljs-title function_">Find</span>(<span class="hljs-params">Tree</span>):<br />  <span class="hljs-keyword">match</span> Tree:<br />    <span class="hljs-keyword">case</span> Square(<span class="hljs-string">&#x27;green&#x27;</span> , <br />            Circle(<span class="hljs-string">&#x27;red&#x27;</span>) <span class="hljs-keyword">as</span> left , <br />            _<br />          ) <span class="hljs-keyword">as</span> root:<br />            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;case1 \n  <span class="hljs-subst">{root = }</span> \n <span class="hljs-subst">{left = }</span> \n &#x27;</span>)<br />      <br />    <span class="hljs-keyword">case</span> Geometric( _ , <br />              Triangle(<span class="hljs-string">&#x27;yellow&#x27;</span>) <span class="hljs-keyword">as</span> left,<br />              Rectangle(<span class="hljs-string">&#x27;blue&#x27;</span>)  <span class="hljs-keyword">as</span> right,<br />            ):<br />            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;case2 \n <span class="hljs-subst">{left = }</span> \n <span class="hljs-subst">{right = }</span> \n&#x27;</span>)<br /><br />    <span class="hljs-keyword">case</span> Circle(<span class="hljs-string">&#x27;yellow&#x27;</span>, <br />             _ ,<br />             Rectangle(<span class="hljs-string">&#x27;blue&#x27;</span>,<br />                Triangle(<span class="hljs-string">&#x27;red&#x27;</span>),<br />                Rectangle(<span class="hljs-string">&#x27;red&#x27;</span>,<br />                    _ ,<br />                    Square(<span class="hljs-string">&#x27;green&#x27;</span>)<br />                ),<br />             ) <span class="hljs-keyword">as</span> right<br />          ) <span class="hljs-keyword">as</span> root:<br />            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;case3 \n <span class="hljs-subst">{root = }</span> \n <span class="hljs-subst">{right = }</span> \n &#x27;</span>)<br />            <br />    <span class="hljs-keyword">case</span> _:<br />            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Not Found \n&#x27;</span>)</span></pre><p name="45dc" id="45dc" class="graf graf--p graf-after--pre">From this example, we can see the power of pattern matching, not only to compare nodes with explicit conditions, but also to compare fuzzy conditions as in case 2. It’s not just easier to write code, it’s easier to map the ideas we have in our head directly to the code.</p><p name="adcf" id="adcf" class="graf graf--p graf-after--p">In fact, database and big data engine optimizers make heavy use of pattern matching (not in Python) because the patterns that optimizers need to match are so complex that it would be very difficult to maintain code that simply uses <code class="markup--code markup--p-code">if-else</code>.</p><h3 name="f209" id="f209" class="graf graf--h3 graf-after--p">Conclusion</h3><p name="9cc1" id="9cc1" class="graf graf--p graf-after--h3">Pattern matching is a powerful technique, it’s not just a simple <code class="markup--code markup--p-code">if-else</code> or <code class="markup--code markup--p-code">switch-case</code>, it’s a “pattern matching”.</p><p name="fbc5" id="fbc5" class="graf graf--p graf-after--p">However, in our daily lives, we seldom really utilize the power of pattern matching, both because we seldom deal with a large number of nested structures, and because we misunderstand the scenarios applied to them.</p><p name="383a" id="383a" class="graf graf--p graf-after--p">Here’s a classic example from <a href="https://stackoverflow.com/questions/69710333/is-there-a-way-to-match-inequalities-in-python-%E2%89%A5-3-10" data-href="https://stackoverflow.com/questions/69710333/is-there-a-way-to-match-inequalities-in-python-%E2%89%A5-3-10" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Stack Overflow</a>. I’ve captured the answer with the most likes.</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="python" name="ea5a" id="ea5a" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">match</span> a:<br />    <span class="hljs-keyword">case</span> _ <span class="hljs-keyword">if</span> a &lt; <span class="hljs-number">42</span>:<br />        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Less&#x27;</span>)<br />    <span class="hljs-keyword">case</span> _ <span class="hljs-keyword">if</span> a == <span class="hljs-number">42</span>:<br />        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;The answer&#x27;</span>)<br />    <span class="hljs-keyword">case</span> _ <span class="hljs-keyword">if</span> a &gt; <span class="hljs-number">42</span>:<br />        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Greater&#x27;</span>)</span></pre><p name="56c4" id="56c4" class="graf graf--p graf-after--pre">Is this really better than <code class="markup--code markup--p-code">if-else</code>?</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="bash" name="6eb4" id="6eb4" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">if</span> a &lt; 42:<br />    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Less&#x27;</span>)<br /><span class="hljs-keyword">elif</span> a == 42:<br />    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;The answer&#x27;</span>)<br /><span class="hljs-keyword">elif</span> a &gt; 42:<br />    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Greater&#x27;</span>)</span></pre><p name="d6e2" id="d6e2" class="graf graf--p graf-after--pre">I believe that most people don’t think so, and this is a typical misapplication scenario.</p><p name="30fd" id="30fd" class="graf graf--p graf-after--p">To sum up, the scenario where pattern matching is used is not conditional comparison, but pattern comparison. In addition, the real power of pattern matching is the nested structure.</p><p name="3581" id="3581" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Reference</strong></p><ul class="postList"><li name="1c31" id="1c31" class="graf graf--li graf-after--p"><a href="https://stackoverflow.com/questions/71151429/using-python-ast-to-determine-if-a-string-has-been-hard-coded-into-a-print-call/71151862#71151862" data-href="https://stackoverflow.com/questions/71151429/using-python-ast-to-determine-if-a-string-has-been-hard-coded-into-a-print-call/71151862#71151862" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">AST Tree</a></li><li name="fb46" id="fb46" class="graf graf--li graf-after--li graf--trailing"><a href="https://blog.douenergy.com/what-is-the-postgres-sql-game-plan-i/" data-href="https://blog.douenergy.com/what-is-the-postgres-sql-game-plan-i/" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">Parsing Tree</a></li></ul></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@lazypro" class="p-author h-card">Chunting Wu</a> on <a href="https://medium.com/p/a7cf8e308e3c"><time class="dt-published" datetime="2023-08-28T01:42:22.427Z">August 28, 2023</time></a>.</p><p><a href="https://medium.com/@lazypro/understanding-use-cases-for-pattern-matching-a7cf8e308e3c" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on October 21, 2024.</p></footer></article></body></html>