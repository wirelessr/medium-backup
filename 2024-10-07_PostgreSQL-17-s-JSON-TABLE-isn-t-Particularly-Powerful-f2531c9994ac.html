<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>PostgreSQL 17’s JSON_TABLE isn’t Particularly Powerful</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">PostgreSQL 17’s JSON_TABLE isn’t Particularly Powerful</h1>
</header>
<section data-field="subtitle" class="p-summary">
Exploring practical differences between JSONB and JSON_TABLE in PostgreSQL 17
</section>
<section data-field="body" class="e-content">
<section name="5312" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="8a42" id="8a42" class="graf graf--h3 graf--leading graf--title">PostgreSQL 17’s JSON_TABLE isn’t Particularly Powerful</h3><h4 name="87e3" id="87e3" class="graf graf--h4 graf-after--h3 graf--subtitle">Exploring practical differences between JSONB and JSON_TABLE in PostgreSQL 17</h4><figure name="1832" id="1832" class="graf graf--figure graf-after--h4"><img class="graf-image" data-image-id="1*DactiFjhV87_GBS_y9h4pA.png" data-width="2530" data-height="1256" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*DactiFjhV87_GBS_y9h4pA.png"><figcaption class="imageCaption">My girl</figcaption></figure><p name="fc40" id="fc40" class="graf graf--p graf-after--figure">Recently Postgres 17 was released, and one of the features interesting to me was the <code class="markup--code markup--p-code">JSON_TABLE</code> keyword. Postgres has always had an ambition to dominate the database market, and of course that includes document databases.</p><p name="5a9c" id="5a9c" class="graf graf--p graf-after--p">After the release of <code class="markup--code markup--p-code">JSONB</code> support in previous versions of Postgres, this time JSON structures have been made more descriptive. I was expecting a lot of groundbreaking, but <code class="markup--code markup--p-code">JSON_TABLE</code> looks a bit &quot;ordinary&quot;. In my opinion, <code class="markup--code markup--p-code">JSON_TABLE</code> just provides syntactic sugar, not much difference in usage.</p><p name="71b6" id="71b6" class="graf graf--p graf-after--p">Let’s take a quick look at some examples to get a feel for the difference between <code class="markup--code markup--p-code">JSON_TABLE</code> and the <code class="markup--code markup--p-code">JSONB</code> of the past.</p><h3 name="a6af" id="a6af" class="graf graf--h3 graf-after--p">Preparation</h3><p name="7e5b" id="7e5b" class="graf graf--p graf-after--h3">Let’s start by creating a table. In order to be as close to the document database as possible, we’ll use a single JSONB column to store all the order data, including the order item and the customer.</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="sql" name="6cf1" id="6cf1" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> orders (<br />  id serial <span class="hljs-keyword">PRIMARY</span> KEY,<br />  order_data JSONB<br />);</span></pre><p name="88c6" id="88c6" class="graf graf--p graf-after--pre">Then we put in two orders, each with two items.</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="sql" name="6c1b" id="6c1b" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> orders (order_data) <span class="hljs-keyword">VALUES</span><br />(<span class="hljs-string">&#x27;{<br />  &quot;items&quot;: [<br />    { &quot;name&quot;: &quot;Laptop&quot;, &quot;price&quot;: 1200 },<br />    { &quot;name&quot;: &quot;Mouse&quot;, &quot;price&quot;: 25 }<br />  ],<br />  &quot;customer&quot;: { &quot;id&quot;: 123, &quot;name&quot;: &quot;John Doe&quot; }<br />}&#x27;</span>),<br />(<span class="hljs-string">&#x27;{<br />  &quot;items&quot;: [<br />    { &quot;name&quot;: &quot;Keyboard&quot;, &quot;price&quot;: 100 },<br />    { &quot;name&quot;: &quot;Monitor&quot;, &quot;price&quot;: 300 }<br />  ],<br />  &quot;customer&quot;: { &quot;id&quot;: 456, &quot;name&quot;: &quot;Jane Smith&quot; }<br />}&#x27;</span>);</span></pre><p name="7183" id="7183" class="graf graf--p graf-after--pre">Okay, let’s experience <code class="markup--code markup--p-code">JSON_TABLE</code>.</p><h3 name="f598" id="f598" class="graf graf--h3 graf-after--p">JSON_TABLE vs. JSONB</h3><p name="1c90" id="1c90" class="graf graf--p graf-after--h3">In the past, when we wanted to query for orders with Laptop we would manipulate <code class="markup--code markup--p-code">items</code> through <code class="markup--code markup--p-code">jsonb_array_elements</code>.</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="sql" name="62ff" id="62ff" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">SELECT</span><br />  item<span class="hljs-operator">-</span><span class="hljs-operator">&gt;&gt;</span><span class="hljs-string">&#x27;name&#x27;</span> <span class="hljs-keyword">AS</span> item_name,<br />  item<span class="hljs-operator">-</span><span class="hljs-operator">&gt;&gt;</span><span class="hljs-string">&#x27;price&#x27;</span> <span class="hljs-keyword">AS</span> item_price,<br />  order_data <span class="hljs-comment">-- whole order including Laptop</span><br /><span class="hljs-keyword">FROM</span><br />  orders,<br />  jsonb_array_elements(order_data<span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span><span class="hljs-string">&#x27;items&#x27;</span>) <span class="hljs-keyword">AS</span> item<br /><span class="hljs-keyword">WHERE</span><br />  item<span class="hljs-operator">-</span><span class="hljs-operator">&gt;&gt;</span><span class="hljs-string">&#x27;name&#x27;</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;Laptop&#x27;</span>;</span></pre><p name="16bc" id="16bc" class="graf graf--p graf-after--pre">So what would this query look like with <code class="markup--code markup--p-code">JSON_TABLE</code>? Let&#39;s see the following example.</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="sql" name="51a5" id="51a5" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">SELECT</span><br />  jt.item_name,<br />  jt.item_price,<br />  order_data<br /><span class="hljs-keyword">FROM</span> orders o,<br />  <span class="hljs-built_in">json_table</span>(o.order_data, <span class="hljs-string">&#x27;$.items[*]&#x27;</span><br />  COLUMNS (<br />    item_name TEXT PATH <span class="hljs-string">&#x27;$.name&#x27;</span>,<br />    item_price <span class="hljs-type">NUMERIC</span> PATH <span class="hljs-string">&#x27;$.price&#x27;</span><br />  )) <span class="hljs-keyword">AS</span> jt<br /><span class="hljs-keyword">WHERE</span> jt.item_name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;Laptop&#x27;</span>;</span></pre><p name="0035" id="0035" class="graf graf--p graf-after--pre">I have to say the difference is not obvious, but that’s partly because string matching is pretty simple. If we want to look up the price of an item, we’ll start to see the advantages of <code class="markup--code markup--p-code">JSON_TABLE</code>.</p><p name="f502" id="f502" class="graf graf--p graf-after--p">Suppose we want to find an order with an item price less than 100, we use the original <code class="markup--code markup--p-code">JSONB</code> as follows.</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="sql" name="147a" id="147a" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">SELECT</span><br />  item<span class="hljs-operator">-</span><span class="hljs-operator">&gt;&gt;</span><span class="hljs-string">&#x27;name&#x27;</span> <span class="hljs-keyword">AS</span> item_name,<br />  item<span class="hljs-operator">-</span><span class="hljs-operator">&gt;&gt;</span><span class="hljs-string">&#x27;price&#x27;</span> <span class="hljs-keyword">AS</span> item_price,<br />  order_data<br /><span class="hljs-keyword">FROM</span><br />  orders,<br />  jsonb_array_elements(order_data<span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span><span class="hljs-string">&#x27;items&#x27;</span>) <span class="hljs-keyword">AS</span> item<br /><span class="hljs-keyword">WHERE</span><br />  (item<span class="hljs-operator">-</span><span class="hljs-operator">&gt;&gt;</span><span class="hljs-string">&#x27;price&#x27;</span>)::<span class="hljs-type">numeric</span> <span class="hljs-operator">&lt;</span> <span class="hljs-number">100</span>;</span></pre><p name="08be" id="08be" class="graf graf--p graf-after--pre">We have to add explicit type casts so that we can compare numbers. But in <code class="markup--code markup--p-code">JSON_TABLE</code> query, since there are already defined type casts, we can compare directly.</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="sql" name="6330" id="6330" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">SELECT</span><br />  jt.item_name,<br />  jt.item_price,<br />  order_data<br /><span class="hljs-keyword">FROM</span> orders o,<br />  <span class="hljs-built_in">json_table</span>(o.order_data, <span class="hljs-string">&#x27;$.items[*]&#x27;</span><br />  COLUMNS (<br />    item_name TEXT PATH <span class="hljs-string">&#x27;$.name&#x27;</span>,<br />    item_price <span class="hljs-type">NUMERIC</span> PATH <span class="hljs-string">&#x27;$.price&#x27;</span><br />  )) <span class="hljs-keyword">AS</span> jt<br /><span class="hljs-keyword">WHERE</span> jt.item_price <span class="hljs-operator">&lt;</span> <span class="hljs-number">100</span>;</span></pre><h3 name="1540" id="1540" class="graf graf--h3 graf-after--pre">Nested JSON</h3><p name="30b4" id="30b4" class="graf graf--p graf-after--h3">Now we’ve familiarized ourselves with general JSON manipulation, let’s look at the benefits of nested JSON in a <code class="markup--code markup--p-code">JSON_TABLE</code>.</p><p name="6a12" id="6a12" class="graf graf--p graf-after--p">Let’s start by inserting a few test data.</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="sql" name="d7c4" id="d7c4" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> orders (order_data) <span class="hljs-keyword">VALUES</span><br />(<span class="hljs-string">&#x27;{&quot;order&quot;: {&quot;items&quot;: [{&quot;name&quot;: &quot;Laptop&quot;, &quot;price&quot;: 1200, &quot;details&quot;: {&quot;warranty&quot;: &quot;2 years&quot;, &quot;color&quot;: &quot;gray&quot;}}, {&quot;name&quot;: &quot;Mouse&quot;, &quot;price&quot;: 25, &quot;details&quot;: {&quot;warranty&quot;: &quot;1 year&quot;, &quot;color&quot;: &quot;black&quot;}}], &quot;customer&quot;: {&quot;id&quot;: 123, &quot;name&quot;: &quot;John Doe&quot;}}}&#x27;</span>),<br />(<span class="hljs-string">&#x27;{&quot;order&quot;: {&quot;items&quot;: [{&quot;name&quot;: &quot;Keyboard&quot;, &quot;price&quot;: 70, &quot;details&quot;: {&quot;warranty&quot;: &quot;1 year&quot;, &quot;color&quot;: &quot;blue&quot;}}, {&quot;name&quot;: &quot;Monitor&quot;, &quot;price&quot;: 300, &quot;details&quot;: {&quot;warranty&quot;: &quot;3 years&quot;, &quot;color&quot;: &quot;black&quot;}}], &quot;customer&quot;: {&quot;id&quot;: 456, &quot;name&quot;: &quot;Jane Smith&quot;}}}&#x27;</span>),<br />(<span class="hljs-string">&#x27;{&quot;order&quot;: {&quot;items&quot;: [{&quot;name&quot;: &quot;Tablet&quot;, &quot;price&quot;: 400, &quot;details&quot;: {&quot;warranty&quot;: &quot;2 years&quot;, &quot;color&quot;: &quot;white&quot;}}], &quot;customer&quot;: {&quot;id&quot;: 789, &quot;name&quot;: &quot;Alice Johnson&quot;}}}&#x27;</span>);</span></pre><p name="58bb" id="58bb" class="graf graf--p graf-after--pre">There is now an additional <code class="markup--code markup--p-code">details</code> attribute for each order item, which contains the color and warranty.</p><p name="f69e" id="f69e" class="graf graf--p graf-after--p">I would like to check the items that are blue in color, and I can do this with <code class="markup--code markup--p-code">JSONB</code>.</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="sql" name="2111" id="2111" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">SELECT</span><br />  item<span class="hljs-operator">-</span><span class="hljs-operator">&gt;&gt;</span><span class="hljs-string">&#x27;name&#x27;</span> <span class="hljs-keyword">AS</span> item_name,<br />  item<span class="hljs-operator">-</span><span class="hljs-operator">&gt;&gt;</span><span class="hljs-string">&#x27;price&#x27;</span> <span class="hljs-keyword">AS</span> item_price,<br />  item<span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span><span class="hljs-string">&#x27;details&#x27;</span><span class="hljs-operator">-</span><span class="hljs-operator">&gt;&gt;</span><span class="hljs-string">&#x27;warranty&#x27;</span> <span class="hljs-keyword">AS</span> warranty<br /><span class="hljs-keyword">FROM</span><br />  orders,<br />  jsonb_array_elements(order_data<span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span><span class="hljs-string">&#x27;order&#x27;</span><span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span><span class="hljs-string">&#x27;items&#x27;</span>) <span class="hljs-keyword">AS</span> item<br /><span class="hljs-keyword">WHERE</span><br />  item<span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span><span class="hljs-string">&#x27;details&#x27;</span><span class="hljs-operator">-</span><span class="hljs-operator">&gt;&gt;</span><span class="hljs-string">&#x27;color&#x27;</span> <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;blue&#x27;</span>;</span></pre><p name="705e" id="705e" class="graf graf--p graf-after--pre">As we can see from the <code class="markup--code markup--p-code">WHERE</code> clause above, our chain is starting to get longer. But in the <code class="markup--code markup--p-code">JSON_TABLE</code> query we can keep the <code class="markup--code markup--p-code">WHERE</code> simple.</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="sql" name="0085" id="0085" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">SELECT</span><br />  jt.item_name,<br />  jt.item_price,<br />  jt.warranty<br /><span class="hljs-keyword">FROM</span> orders o,<br />  <span class="hljs-built_in">json_table</span>(o.order_data, <span class="hljs-string">&#x27;$.order.items[*]&#x27;</span><br />  COLUMNS (<br />    item_name TEXT PATH <span class="hljs-string">&#x27;$.name&#x27;</span>,<br />    item_price <span class="hljs-type">NUMERIC</span> PATH <span class="hljs-string">&#x27;$.price&#x27;</span>,<br />    warranty TEXT PATH <span class="hljs-string">&#x27;$.details.warranty&#x27;</span>,<br />    color TEXT PATH <span class="hljs-string">&#x27;$.details.color&#x27;</span><br />  )) <span class="hljs-keyword">AS</span> jt<br /><span class="hljs-keyword">WHERE</span> jt.color <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;blue&#x27;</span>;</span></pre><h3 name="1514" id="1514" class="graf graf--h3 graf-after--pre">Conclusion</h3><p name="1406" id="1406" class="graf graf--p graf-after--h3">In a simple JSON query, <code class="markup--code markup--p-code">JSON_TABLE</code> really doesn&#39;t have any advantage at all. But when the query gets complex, the fact that <code class="markup--code markup--p-code">SELECT</code> and <code class="markup--code markup--p-code">WHERE</code> can still be kept simple under the <code class="markup--code markup--p-code">JSON_TABLE</code> structure is a big advantage.</p><p name="5a65" id="5a65" class="graf graf--p graf-after--p">Personally, I’m happy to see Postgres continue to improve its document database features, which will probably force other SQL based databases to start following along.</p><p name="41c7" id="41c7" class="graf graf--p graf-after--p graf--trailing">Overall, <code class="markup--code markup--p-code">JSON_TABLE</code> is a step forward, and there are many more possibilities for structuring unstructured data in the future.</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@lazypro" class="p-author h-card">Chunting Wu</a> on <a href="https://medium.com/p/f2531c9994ac"><time class="dt-published" datetime="2024-10-07T01:34:49.111Z">October 7, 2024</time></a>.</p><p><a href="https://medium.com/@lazypro/postgresql-17s-json-table-isn-t-particularly-powerful-f2531c9994ac" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on October 21, 2024.</p></footer></article></body></html>