<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Getting Started with Flink SQL, Apache Iceberg and DynamoDB Catalog</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Getting Started with Flink SQL, Apache Iceberg and DynamoDB Catalog</h1>
</header>
<section data-field="subtitle" class="p-summary">
Navigating Flink SQL, Apache Iceberg, and DynamoDB Catalog for a Lakehouse Experience
</section>
<section data-field="body" class="e-content">
<section name="e6da" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="614f" id="614f" class="graf graf--h3 graf--leading graf--title">Getting Started with Flink SQL, Apache Iceberg and DynamoDB Catalog</h3><h4 name="323b" id="323b" class="graf graf--h4 graf-after--h3 graf--subtitle">Navigating Flink SQL, Apache Iceberg, and DynamoDB Catalog for a Lakehouse Experience</h4><figure name="327a" id="327a" class="graf graf--figure graf-after--h4"><img class="graf-image" data-image-id="0*f3Xbi4Ln0uLjQO0P" data-width="800" data-height="218" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/0*f3Xbi4Ln0uLjQO0P"><figcaption class="imageCaption"><a href="https://github.com/apache/iceberg" data-href="https://github.com/apache/iceberg" class="markup--anchor markup--figure-anchor" rel="nofollow noopener" target="_blank">https://github.com/apache/iceberg</a></figcaption></figure><p name="dbb1" id="dbb1" class="graf graf--p graf-after--figure">Due to the technology transformation we want to do recently, we started to investigate <a href="https://iceberg.apache.org/" data-href="https://iceberg.apache.org/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Apache Iceberg</a>. In addition, the data processing engine we use in house is <a href="https://flink.apache.org/" data-href="https://flink.apache.org/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Apache Flink</a>, so it’s only fair to look for an experiment environment that integrates Flink and Iceberg.</p><p name="0a67" id="0a67" class="graf graf--p graf-after--p">The purpose of this experiment is simply to experience using Flink SQL to operate Iceberg, but I didn’t realize that it would be so difficult to set up the whole environment.</p><p name="42cc" id="42cc" class="graf graf--p graf-after--p">Actually, Iceberg’s <a href="https://iceberg.apache.org/docs/latest/flink/" data-href="https://iceberg.apache.org/docs/latest/flink/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">official document</a> has a “large” description of the integration with Flink, but it is based on Hadoop and Hive. For a data engineer who has not experienced the legacy Hadoop ecosystem, Hadoop is like an abyss, and obviously the official documents don’t work.</p><p name="ff34" id="ff34" class="graf graf--p graf-after--p">So I referred to <a href="https://www.dremio.com/blog/getting-started-with-flink-sql-and-apache-iceberg/" data-href="https://www.dremio.com/blog/getting-started-with-flink-sql-and-apache-iceberg/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Dremio’s article</a>, fixed a few fatal flaws in the article, and finally built an experiment environment where I could experience the full Flink Iceberg integration. Moreover, it’s completely local and free of charge.</p><p name="de2c" id="de2c" class="graf graf--p graf-after--p">Before introducing the environment, let’s quickly introduce Iceberg.</p><h3 name="d24b" id="d24b" class="graf graf--h3 graf-after--p">A short introduction to Iceberg</h3><p name="7ae6" id="7ae6" class="graf graf--p graf-after--h3">Apache Iceberg is one of the three types of lakehouse, the other two are <a href="https://hudi.apache.org/" data-href="https://hudi.apache.org/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Apache Hudi</a> and <a href="https://delta.io/" data-href="https://delta.io/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Delta Lake</a>.</p><p name="38f2" id="38f2" class="graf graf--p graf-after--p">Lakehouse, in a nutshell, is to provide a layer of interface for Object Storage that can be operated by SQL, so that lakehouse has more structured data than data lake and has the ease of use of a data warehouse.</p><p name="bf17" id="bf17" class="graf graf--p graf-after--p">In addition, lakehouse also provides integration with major common data processing engines, so we can enjoy the low cost of Object Storage but at the same time make the data easy to use.</p><p name="ecb5" id="ecb5" class="graf graf--p graf-after--p">Here’s a diagram that I found very impressive.</p><figure name="86ab" id="86ab" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="0*rdFO09Xqqeid7zgr.gif" data-width="1920" data-height="1080" src="https://cdn-images-1.medium.com/max/800/0*rdFO09Xqqeid7zgr.gif"><figcaption class="imageCaption"><a href="https://www.starburst.io/blog/introduction-to-apache-iceberg-in-trino/" data-href="https://www.starburst.io/blog/introduction-to-apache-iceberg-in-trino/" class="markup--anchor markup--figure-anchor" rel="nofollow noopener" target="_blank">https://www.starburst.io/blog/introduction-to-apache-iceberg-in-trino/</a></figcaption></figure><blockquote name="ef9e" id="ef9e" class="graf graf--blockquote graf-after--figure"><em class="markup--em markup--blockquote-em">Comparison of the three types of lakehouses is not the point of this article, there is a detailed benchmark in </em><a href="https://www.onehouse.ai/blog/apache-hudi-vs-delta-lake-vs-apache-iceberg-lakehouse-feature-comparison" data-href="https://www.onehouse.ai/blog/apache-hudi-vs-delta-lake-vs-apache-iceberg-lakehouse-feature-comparison" class="markup--anchor markup--blockquote-anchor" rel="noopener" target="_blank"><em class="markup--em markup--blockquote-em">Kyle Weller’s article</em></a><em class="markup--em markup--blockquote-em">.</em></blockquote><h3 name="036d" id="036d" class="graf graf--h3 graf-after--blockquote">Experiment environment</h3><p name="10f7" id="10f7" class="graf graf--p graf-after--h3">After reading the above introduction, we understand in order to be able to perform structured data operations on Object Storage, we need a mechanism to store a schema, which is called a catalog on Iceberg.</p><p name="8830" id="8830" class="graf graf--p graf-after--p">Iceberg provides a number of options for implementing catalogs, including the Hive metastore mentioned at the beginning, and DynamoDB, which will be used in this article.</p><p name="502d" id="502d" class="graf graf--p graf-after--p">The entire playground is completely free, and at its core are the following three components.</p><ol class="postList"><li name="6015" id="6015" class="graf graf--li graf-after--p">DynamoDB: This is the catalog store, and uses the local version to avoid expenses.</li><li name="f5a0" id="f5a0" class="graf graf--li graf-after--li">Minio: This is where the actual iceberg is stored, again using minio to avoid the expense of s3.</li><li name="ddcc" id="ddcc" class="graf graf--li graf-after--li">Flink: the key to Playground.</li></ol><p name="d76c" id="d76c" class="graf graf--p graf-after--li">The entire experiment environment has been in Github, you can clone to follow the steps.</p><div name="ff98" id="ff98" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://github.com/wirelessr/flink-iceberg-playground" data-href="https://github.com/wirelessr/flink-iceberg-playground" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://github.com/wirelessr/flink-iceberg-playground"><strong class="markup--strong markup--mixtapeEmbed-strong">GitHub - wirelessr/flink-iceberg-playground: minio as local storage and DynamoDB as catalog</strong><br><em class="markup--em markup--mixtapeEmbed-em">minio as local storage and DynamoDB as catalog. Contribute to wirelessr/flink-iceberg-playground development by…</em>github.com</a><a href="https://github.com/wirelessr/flink-iceberg-playground" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="9821608b63867512e0fe294cedc44f3f" data-thumbnail-img-id="0*qrForsofgh_ATLj6" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*qrForsofgh_ATLj6);"></a></div><h3 name="13ea" id="13ea" class="graf graf--h3 graf-after--mixtapeEmbed">The journey of experimentation</h3><p name="4207" id="4207" class="graf graf--p graf-after--h3">This environment is extremely easy to use, all you have to do is <code class="markup--code markup--p-code">docker-compose up -d</code> and you’re good to go.</p><p name="329e" id="329e" class="graf graf--p graf-after--p">But to get it working, I looked at a lot of articles and found that none of them actually worked, either they were buggy or just provided snippets, so I set out to make one myself.</p><p name="d00a" id="d00a" class="graf graf--p graf-after--p">I especially want to talk about Dremio’s article, it inspired me a lot. The only difference is that it uses <code class="markup--code markup--p-code">Nessie</code> as the catalog, and I’m not familiar with Nessie at all, so I used DynamoDB instead.</p><p name="4f7d" id="4f7d" class="graf graf--p graf-after--p">On the other hand, about <code class="markup--code markup--p-code">DynamoDbCatalog</code>, there is poor information on the Internet, not even what parameters need to be modified, I finally found out by reviewing the following source code.</p><div name="9b96" id="9b96" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://github.com/apache/iceberg/blob/f21199d002c6ad008a6772783b4fdad622c09b59/aws/src/main/java/org/apache/iceberg/aws/AwsProperties.java#L113" data-href="https://github.com/apache/iceberg/blob/f21199d002c6ad008a6772783b4fdad622c09b59/aws/src/main/java/org/apache/iceberg/aws/AwsProperties.java#L113" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://github.com/apache/iceberg/blob/f21199d002c6ad008a6772783b4fdad622c09b59/aws/src/main/java/org/apache/iceberg/aws/AwsProperties.java#L113"><strong class="markup--strong markup--mixtapeEmbed-strong">iceberg/aws/src/main/java/org/apache/iceberg/aws/AwsProperties.java at…</strong><br><em class="markup--em markup--mixtapeEmbed-em">Apache Iceberg. Contribute to apache/iceberg development by creating an account on GitHub.</em>github.com</a><a href="https://github.com/apache/iceberg/blob/f21199d002c6ad008a6772783b4fdad622c09b59/aws/src/main/java/org/apache/iceberg/aws/AwsProperties.java#L113" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="a13998869ef6003b274bb0f4f7c242ea" data-thumbnail-img-id="0*YetU_LGQ5JRMXw9X" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*YetU_LGQ5JRMXw9X);"></a></div><p name="928e" id="928e" class="graf graf--p graf-after--mixtapeEmbed">Changing DynamoDB’s table name should be important if the environment goes to production, but even this parameter (<code class="markup--code markup--p-code">dynamodb.table-name</code>) has to be found in the code.</p><p name="5559" id="5559" class="graf graf--p graf-after--p">In addition, because the experiment environment enabled minio as an alternative to s3, there is another parameter besides endpoint that is also critical, and it requires a change in the path style approach, and again, this parameter (<code class="markup--code markup--p-code">s3.path-style-access</code>) is what I found by looking at the source code, which is completely undocumented.</p><div name="a4fb" id="a4fb" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://github.com/apache/iceberg/blob/f21199d002c6ad008a6772783b4fdad622c09b59/aws/src/main/java/org/apache/iceberg/aws/s3/S3FileIOProperties.java#L155" data-href="https://github.com/apache/iceberg/blob/f21199d002c6ad008a6772783b4fdad622c09b59/aws/src/main/java/org/apache/iceberg/aws/s3/S3FileIOProperties.java#L155" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://github.com/apache/iceberg/blob/f21199d002c6ad008a6772783b4fdad622c09b59/aws/src/main/java/org/apache/iceberg/aws/s3/S3FileIOProperties.java#L155"><strong class="markup--strong markup--mixtapeEmbed-strong">iceberg/aws/src/main/java/org/apache/iceberg/aws/s3/S3FileIOProperties.java at…</strong><br><em class="markup--em markup--mixtapeEmbed-em">Apache Iceberg. Contribute to apache/iceberg development by creating an account on GitHub.</em>github.com</a><a href="https://github.com/apache/iceberg/blob/f21199d002c6ad008a6772783b4fdad622c09b59/aws/src/main/java/org/apache/iceberg/aws/s3/S3FileIOProperties.java#L155" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="96f2d730578579331a71cfe6865a37c8" data-thumbnail-img-id="0*tGq7UM6Ag4XaHhmO" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*tGq7UM6Ag4XaHhmO);"></a></div><p name="a033" id="a033" class="graf graf--p graf-after--mixtapeEmbed">Finally, the experiment environment has been built, there is a docker image that has been packaged with Flink and all the dependencies that need to be built, the image is a bit large and needs to be built for a period of time, so I also provide a ready-made one.</p><div name="ea12" id="ea12" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://hub.docker.com/r/wirelessr/flink-iceberg" data-href="https://hub.docker.com/r/wirelessr/flink-iceberg" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://hub.docker.com/r/wirelessr/flink-iceberg"><strong class="markup--strong markup--mixtapeEmbed-strong">Docker</strong><br><em class="markup--em markup--mixtapeEmbed-em">Edit description</em>hub.docker.com</a><a href="https://hub.docker.com/r/wirelessr/flink-iceberg" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="46c31c103fa90bbb0bc7af20bdee5471"></a></div><p name="3231" id="3231" class="graf graf--p graf-after--mixtapeEmbed graf--trailing">Just replace the image used by <code class="markup--code markup--p-code">sql-client</code> in <code class="markup--code markup--p-code">docker-compose.yml</code>.</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@lazypro" class="p-author h-card">Chunting Wu</a> on <a href="https://medium.com/p/71b96817e3c3"><time class="dt-published" datetime="2023-12-18T01:46:29.433Z">December 18, 2023</time></a>.</p><p><a href="https://medium.com/@lazypro/getting-started-with-flink-sql-apache-iceberg-and-dynamodb-catalog-71b96817e3c3" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on October 21, 2024.</p></footer></article></body></html>