<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Design an E-commerce Website From a High-level Perspective</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Design an E-commerce Website From a High-level Perspective</h1>
</header>
<section data-field="subtitle" class="p-summary">
Put on your software architecture hat
</section>
<section data-field="body" class="e-content">
<section name="a8f4" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="d94f" id="d94f" class="graf graf--h3 graf--leading graf--title">Design an E-commerce Website From a High-level Perspective</h3><h4 name="06d3" id="06d3" class="graf graf--h4 graf-after--h3 graf--subtitle">Put on your software architecture hat</h4><figure name="2ddd" id="2ddd" class="graf graf--figure graf-after--h4"><img class="graf-image" data-image-id="0*W7YBIiPi7xBHFTvQ" data-width="6000" data-height="4000" data-unsplash-photo-id="2loKxdi6Hmo" src="https://cdn-images-1.medium.com/max/800/0*W7YBIiPi7xBHFTvQ"><figcaption class="imageCaption">Photo by <a href="https://unsplash.com/@palon?utm_source=medium&amp;utm_medium=referral" data-href="https://unsplash.com/@palon?utm_source=medium&amp;utm_medium=referral" class="markup--anchor markup--figure-anchor" rel="photo-creator noopener" target="_blank">Yang Deng</a> on <a href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" data-href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" class="markup--anchor markup--figure-anchor" rel="photo-source noopener" target="_blank">Unsplash</a></figcaption></figure><p name="9730" id="9730" class="graf graf--p graf-after--figure">Last two weeks, there was a gathering of architects, in which we talked about e-commerce websites actually having some regular patterns, so if you want to quickly provide a high-level design, how would you do it?</p><p name="0865" id="0865" class="graf graf--p graf-after--p">This article is a record of that discussion, I will list our ideas based on my impressions, and then present the thinking of architects on this classic design pattern.</p><h3 name="4851" id="4851" class="graf graf--h3 graf-after--p">Define Basic Domain Services</h3><p name="5b98" id="5b98" class="graf graf--p graf-after--h3">Usually, for a startup system or architecture, I would recommend starting with a monolith. After constructing the MVP (minimum viable product), the architecture evolves depending on the functional and non-functional requirements to see whether it should be decomposed into microservices or the more popular Service-oriented architecture a few years ago.</p><p name="fb38" id="fb38" class="graf graf--p graf-after--p">But in any case, there will be a monolith as the basis for a quick launch and validation of the idea.</p><p name="577a" id="577a" class="graf graf--p graf-after--p">However, for an e-commerce site, there is no need for quick validation because the success of an e-commerce site depends on the products and exposure strategy rather than the features. Therefore, for e-commerce sites, it is more important to be able to solve the problems that will be encountered in the foreseeable future.</p><p name="55bd" id="55bd" class="graf graf--p graf-after--p">Here are a few practical examples.</p><p name="774e" id="774e" class="graf graf--p graf-after--p">With the rapid growth of users, the demand for user management will increase significantly, so it is necessary for user-related functions to become a separate service to facilitate fast iteration of the development cycle.</p><p name="d1ab" id="d1ab" class="graf graf--p graf-after--p">Inventory, as the number of users on the site rises, the product-related features will drive most of the traffic. Customers are always looking for the products they want on the site and viewing the inventory, so in order to handle the high volume of traffic, it must be able to scale horizontally on its own. Therefore, inventory will also become a standalone service.</p><p name="b0fd" id="b0fd" class="graf graf--p graf-after--p">Another core function of an e-commerce website is the purchase and order management. When a customer places an order, external services such as cash flow and logistics must be integrated behind the scenes, and new functions such as connecting different cash flows need to be implemented continuously. However, this development cycle is obviously different from user-related functions, and the need for testing and integration is completely different from the user services, that is, the order must also become a service.</p><p name="4e83" id="4e83" class="graf graf--p graf-after--p">Finally, we will define basic domain services as follows.</p><figure name="319e" id="319e" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*jtY6iexEvE_m9yN6h0SWxw.png" data-width="1012" data-height="360" src="https://cdn-images-1.medium.com/max/800/1*jtY6iexEvE_m9yN6h0SWxw.png"></figure><h3 name="d614" id="d614" class="graf graf--h3 graf-after--figure">Define Databases</h3><p name="f2a2" id="f2a2" class="graf graf--p graf-after--h3">In the previous section we mentioned that we have three independent services, User, Order and Inventory. Then we had to decide what database they should be using.</p><p name="baf8" id="baf8" class="graf graf--p graf-after--p">For a system that is just starting up, I always recommend using the most mature technology that the team is most familiar with, while taking into account the various use cases.</p><p name="6751" id="6751" class="graf graf--p graf-after--p">For this reason, I believe MySQL should be the best choice for services like Order Service and Inventory Service that require strong consistency. Although MySQL has always been criticized for its lack of horizontal scalability, there have been many new breakthroughs in recent years, and more and more distributed SQL is appearing. If the traffic of an e-commerce site rises to a bottleneck, then the pain of migrating from MySQL to distributed SQL will not be too much, after all, the applications barely need to be modified.</p><p name="2a04" id="2a04" class="graf graf--p graf-after--p">In the case of User Service, this is more interesting. User-related management functions usually do not have strong consistency requirements, and user information and other data structures are varied and plentiful. As a document-based database, MongoDB can support various kinds of rich data presentation and provide a lot of management convenience. Of course, you can also use MySQL for User Service, but you need to put a little more effort into data normalization.</p><p name="c585" id="c585" class="graf graf--p graf-after--p">Besides, if you use MongoDB to implement User Service, even if you have the need of strong consistency in the future, for example, if you want to give customers discount coupons, MongoDB can still provide enough strong consistency guarantee, since MongoDB also has transactions. However, it must be said that MongoDB transactions are not easy to code, which will increase the development effort.</p><h3 name="a6cd" id="a6cd" class="graf graf--h3 graf-after--p">Define Communications</h3><p name="a8b4" id="a8b4" class="graf graf--p graf-after--h3">Now we have three services in charge of their domain, but how do they communicate with each other? For instance, when a customer selects a product, then dispatches the order, billing and shipping, the three services must communicate with each other to complete the scenario.</p><p name="3ef2" id="3ef2" class="graf graf--p graf-after--p">From my point of view, I would recommend that these three services be asynchronous. Although the overall process must ensure consistency, which dramatically increases the implementation effort, only asynchronization can tolerate high availability and high scalability. Availability and scalability are mandatory non-functional requirements for running an e-commerce site.</p><p name="3562" id="3562" class="graf graf--p graf-after--p">For example, in the Black Friday promotion, there will be a large number of customers rushing to the website and placing a large number of orders, assuming that the three services communicate with each other synchronously, then the three services must scale at the same rate, which is obviously unreasonable.</p><p name="fc4e" id="fc4e" class="graf graf--p graf-after--p">In addition, when an order must be served by all three services, and any one of them fails temporarily or the network is temporarily down, the whole order will fail. In other words, only through asynchronous communication can we ensure the availability and scalability required for e-commerce sites.</p><p name="ccb9" id="ccb9" class="graf graf--p graf-after--p">At this point, we had a prototype of our system architecture.</p><figure name="ed95" id="ed95" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*x4cwl2bzztJeW-cn8c3O2w.png" data-width="1346" data-height="468" src="https://cdn-images-1.medium.com/max/800/1*x4cwl2bzztJeW-cn8c3O2w.png"></figure><p name="8ce6" id="8ce6" class="graf graf--p graf-after--figure">However, there is one component that we haven’t decided yet, and that is what kind of queue system should be used for asynchronization. In my opinion, we should use <code class="markup--code markup--p-code">Kafka</code>. Why not use a pure message queue like <code class="markup--code markup--p-code">RabbitMQ</code>? One important reason is that, <code class="markup--code markup--p-code">Kafka</code> has higher throughput when it comes to handling large traffic from a promotion event.</p><p name="b7a3" id="b7a3" class="graf graf--p graf-after--p">Moreover, for behaviors like order and payment, we all know it is sequential. To preserve the message order while a large number of messages are flooding the queue, it is necessary to scale horizontally through <code class="markup--code markup--p-code">Kafka</code>’s consumer groups so that messages can be handled faster and in order at the same time.</p><h3 name="62d9" id="62d9" class="graf graf--h3 graf-after--p">Sketch Workflow</h3><p name="856d" id="856d" class="graf graf--p graf-after--h3">Once we have a simple system architecture, we begin to sketch out the entire order placement process.</p><figure name="990c" id="990c" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*fiY_vLMN-fZhBOic1EEA_A.png" data-width="606" data-height="505" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*fiY_vLMN-fZhBOic1EEA_A.png"></figure><p name="b0ea" id="b0ea" class="graf graf--p graf-after--figure">At the beginning, the customer places an order with the inventory service, and the inventory service only handles inventory-related tasks, e.g., pre-deducting inventory. The purpose of reducing inventory before the payment is to avoid competition when a large number of users are consuming, and if the inventory is not actually reduced until the last stage, then there is a high risk that a consumer will buy air.</p><p name="54ad" id="54ad" class="graf graf--p graf-after--p">When the inventory service has finished processing, the order service is notified that it has taken over the entire transaction while informing the customer that the order has been placed. At this moment, only the order is established, and the payment must be redirected through the frontend so that the customer can properly communicate with the order service to proceed the billing.</p><p name="f878" id="f878" class="graf graf--p graf-after--p">When the payment is completed, the order service will notify the user service. User service can then proceed with user-related tasks, like coupon issuance or user level upgrade. Finally, the inventory service and the order service are informed that the transaction has been successfully completed.</p><p name="038f" id="038f" class="graf graf--p graf-after--p">Or if there is an error in the order service or user service, a message must be sent to inform the other participating services. Then the service that receives the notification can handle it accordingly, for example, the inventory service must add back the pre-reduced inventory.</p><h3 name="adbe" id="adbe" class="graf graf--h3 graf-after--p">But, Not Enough</h3><p name="0597" id="0597" class="graf graf--p graf-after--h3">Readers who have been subscribing to my articles should have seen this is a very typical <a href="https://betterprogramming.pub/design-distributed-transaction-with-practical-examples-7b1d93fddb63" data-href="https://betterprogramming.pub/design-distributed-transaction-with-practical-examples-7b1d93fddb63" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">distributed transaction</a>, and the proper approach to distributed transaction is to always be resilient, i.e., resilient to the errors.</p><p name="16e1" id="16e1" class="graf graf--p graf-after--p">As I described in my previous article, <a href="https://betterprogramming.pub/implement-event-driven-architecture-with-minimal-effort-182c3bbe5524" data-href="https://betterprogramming.pub/implement-event-driven-architecture-with-minimal-effort-182c3bbe5524" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">to handle distributed transactions in an event-driven architecture</a>, an arbiter (crontab) is desired. The crontab detects periodically which events have not been handled correctly and takes corresponding actions to repair them.</p><p name="e25a" id="e25a" class="graf graf--p graf-after--p">The specific details will not be explained again in this article. But we can know in addition to the three domain services, there is another service that monitors the entire workflow.</p><h3 name="ce11" id="ce11" class="graf graf--h3 graf-after--p">But, Still Not Enough</h3><p name="14ce" id="14ce" class="graf graf--p graf-after--h3">Because the entire transaction process is asynchronous, the user must be able to know exactly what the status of the order is, what stage it is at, and so on. Therefore, it is also necessary to have a service that subscribes to the messages sent by each service, and has its own database to record and store the status of all transactions.</p><p name="5ee1" id="5ee1" class="graf graf--p graf-after--p">This approach is also known as <a href="https://medium.com/interviewnoodle/shift-from-monolith-to-cqrs-a34bab75617e" data-href="https://medium.com/interviewnoodle/shift-from-monolith-to-cqrs-a34bab75617e" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">CQRS</a>. The entire workflow is observed through a standalone cross-domain service, but unlike an arbiter, this observer does not actually participate in the workflow, nor does it make any kind of changes to the workflow.</p><p name="ae87" id="ae87" class="graf graf--p graf-after--p">The observer exists only to allow the customer to get a proper overview of the workflow.</p><h3 name="785e" id="785e" class="graf graf--h3 graf-after--p">Conclusion</h3><p name="15c5" id="15c5" class="graf graf--p graf-after--h3">E-commerce websites can be considered as the textbook of all backend architectures. All kinds of problems that backend engineers need to deal with will appear on e-commerce websites, but the books currently available on the market often only provide a monolithic solution, and focus on how to implement those functional requirements.</p><p name="1ffd" id="1ffd" class="graf graf--p graf-after--p">But as backend experts, we all know using a monolith to run an e-commerce site is ultimately a dead end. Unless the product is completely unsellable, it will sooner or later face the challenge of traffic and availability.</p><p name="898c" id="898c" class="graf graf--p graf-after--p">Although this article is a casual conversation among architects, it is actually a look at the challenges we encounter on a daily routine from a different perspective. Why does a startup e-commerce site need to have five services?</p><ul class="postList"><li name="eef0" id="eef0" class="graf graf--li graf-after--p">To add new features more quickly and to have independent integration and testing processes, microservices must be segmented into domains.</li><li name="daf7" id="daf7" class="graf graf--li graf-after--li">To have high availability and scalability, the coupling between domains must be reduced.</li><li name="46f3" id="46f3" class="graf graf--li graf-after--li">For better fault tolerance, a resilient error recovery mechanism must be established.</li><li name="2068" id="2068" class="graf graf--li graf-after--li">For a better user experience, a comprehensive presentation of the whole picture must be implemented.</li></ul><p name="1646" id="1646" class="graf graf--p graf-after--li">Previously, I often mentioned the drawbacks of microservices, eg <a href="https://medium.com/interviewnoodle/original-sin-of-microservices-part-1-90461ddcefb" data-href="https://medium.com/interviewnoodle/original-sin-of-microservices-part-1-90461ddcefb" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Original Sin of Microservices, Part 1</a> and <a href="https://lazypro.medium.com/original-sin-of-microservices-part-2-8856c0e8426d" data-href="https://lazypro.medium.com/original-sin-of-microservices-part-2-8856c0e8426d" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Original Sin of Microservices, Part 2</a>.</p><p name="32ec" id="32ec" class="graf graf--p graf-after--p">But this does not mean I totally reject microservices, instead I hope we can all face microservices with a correct attitude, not as the holy grail but also not as the devil.</p><p name="13da" id="13da" class="graf graf--p graf-after--p graf--trailing">The right trade-off is always the most important core concept of software architecture.</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@lazypro" class="p-author h-card">Chunting Wu</a> on <a href="https://medium.com/p/184618741ee8"><time class="dt-published" datetime="2022-04-18T00:41:17.518Z">April 18, 2022</time></a>.</p><p><a href="https://medium.com/@lazypro/design-an-e-commerce-website-from-a-high-level-perspective-184618741ee8" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on October 21, 2024.</p></footer></article></body></html>