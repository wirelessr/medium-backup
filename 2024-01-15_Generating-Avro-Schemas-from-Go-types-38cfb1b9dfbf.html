<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Generating Avro Schemas from Go types</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Generating Avro Schemas from Go types</h1>
</header>
<section data-field="subtitle" class="p-summary">
To implement auto data ingest, reflect go struct into Avro
</section>
<section data-field="body" class="e-content">
<section name="e7fc" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="2e03" id="2e03" class="graf graf--h3 graf--leading graf--title">Generating Avro Schemas from Go types</h3><h4 name="65af" id="65af" class="graf graf--h4 graf-after--h3 graf--subtitle">To implement auto data ingest, reflect go struct into Avro</h4><figure name="1baa" id="1baa" class="graf graf--figure graf-after--h4"><img class="graf-image" data-image-id="0*eR_eVjEO35VNBXWw" data-width="1000" data-height="665" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/0*eR_eVjEO35VNBXWw"><figcaption class="imageCaption">Photo by <a href="https://unsplash.com/@david_thielen" data-href="https://unsplash.com/@david_thielen" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank">David Thielen</a> on <a href="https://unsplash.com/photos/brown-and-white-rodent-on-snow-covered-ground-during-daytime-Om-Z4TDfv7o" data-href="https://unsplash.com/photos/brown-and-white-rodent-on-snow-covered-ground-during-daytime-Om-Z4TDfv7o" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank">Unsplash</a></figcaption></figure><p name="5ac7" id="5ac7" class="graf graf--p graf-after--figure">Previously, I have introduced the evolutionary history of data infrastructure, and I have also introduced real-time data analysis in detail.</p><ul class="postList"><li name="c1d9" id="c1d9" class="graf graf--li graf-after--p"><a href="https://betterprogramming.pub/evolutionary-data-infrastructure-4ddce2ec8a7e" data-href="https://betterprogramming.pub/evolutionary-data-infrastructure-4ddce2ec8a7e" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">Evolutionary Data Infrastructure</a></li><li name="d13c" id="d13c" class="graf graf--li graf-after--li"><a href="https://betterprogramming.pub/real-time-data-infra-stack-73c597ed05ee" data-href="https://betterprogramming.pub/real-time-data-infra-stack-73c597ed05ee" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">The Infrastructure Stack for Real-Time Data Analysis</a></li></ul><p name="10b9" id="10b9" class="graf graf--p graf-after--li">Both of these articles mention a key player, <a href="https://debezium.io/" data-href="https://debezium.io/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Debezium</a>. In fact, Debezium has had a place in the modern infrastructure. Let’s use a diagram to understand why.</p><figure name="0e36" id="0e36" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*7dOs8Bc1w_EkK-LsA8WITA.png" data-width="1198" data-height="502" src="https://cdn-images-1.medium.com/max/800/1*7dOs8Bc1w_EkK-LsA8WITA.png"></figure><p name="3349" id="3349" class="graf graf--p graf-after--figure">This architecture diagram should be consistent with the data ingest path of most data infrastructures. In order to store and analyze data in a unified way, centralizing the data in a data warehouse is a general solution.</p><p name="de9e" id="de9e" class="graf graf--p graf-after--p">Debezium captures data changes from various source databases and then writes them to the data warehouse via Kafka and Kafka’s consumers. In other words, Debezium is also a Kafka producer.</p><p name="8168" id="8168" class="graf graf--p graf-after--p">This architecture looks fine, once there are changes in the data will be captured by Debezium and eventually written to the data warehouse, but there is actually a difficult problem behind needs to be solved, that is, the database schema. In order to provide data analytics, the data warehouse is “schemaful”, but how to make the schema of the data warehouse align with the schema of each source database?</p><p name="b29f" id="b29f" class="graf graf--p graf-after--p">The good news is Debezium supports schema registry, it can capture DDL changes from source databases and synchronize them to the schema registry so that Kafka consumers can get schema from the schema registry and synchronize the schema in the data warehouse.</p><p name="5809" id="5809" class="graf graf--p graf-after--p">Let’s make the architecture mentioned above even more complete.</p><figure name="5846" id="5846" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*F-LynAHg0cMvENt1R2Og8A.png" data-width="1198" data-height="410" src="https://cdn-images-1.medium.com/max/800/1*F-LynAHg0cMvENt1R2Og8A.png"></figure><p name="7841" id="7841" class="graf graf--p graf-after--figure">The most common format for describing schema in this scenario is <a href="https://avro.apache.org/" data-href="https://avro.apache.org/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Apache Avro</a>.</p><p name="2342" id="2342" class="graf graf--p graf-after--p">Unfortunately, a schemaless database like MongoDB doesn’t have DDL at all, so of course Debezium can’t capture DDL, then how does Debezium upload the schema in this scenario? The answer is to guess, by getting the data to determine the data type, and write the type into the schema registry.</p><p name="51af" id="51af" class="graf graf--p graf-after--p">As you can imagine, this is very risky, and the data warehouse schema often faces compatibility challenges due to such guessing. Therefore, there needs to be a way to proactively upload the schema so that the Kafka consumer can correctly recognize the data type and correct the schema of the data warehouse.</p><h3 name="907e" id="907e" class="graf graf--h3 graf-after--p">Knowing it intellectually is one thing, but knowing it emotionally is quite another.</h3><p name="06c7" id="06c7" class="graf graf--p graf-after--h3">The story is this: our microservice is developed in Golang and uses <a href="https://github.com/Kamva/mgm" data-href="https://github.com/Kamva/mgm" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">mgm</a> as the ORM for MongoDB.</p><p name="0f19" id="0f19" class="graf graf--p graf-after--p">In Golang, we use <code class="markup--code markup--p-code">struct</code> as a Data Transfer Object (DTO), and in the <code class="markup--code markup--p-code">mgm</code> scenario, these DTOs can be marshaled as JSON. So, what we need to do is to generate the corresponding Avro schema based on the definition of <code class="markup--code markup--p-code">struct</code>.</p><p name="4e70" id="4e70" class="graf graf--p graf-after--p">Therefore, I made the following go module.</p><div name="e959" id="e959" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://github.com/wirelessr/avroschema" data-href="https://github.com/wirelessr/avroschema" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://github.com/wirelessr/avroschema"><strong class="markup--strong markup--mixtapeEmbed-strong">GitHub - wirelessr/avroschema: Generate AVRO Schemas from Go types</strong><br><em class="markup--em markup--mixtapeEmbed-em">Generate AVRO Schemas from Go types. Contribute to wirelessr/avroschema development by creating an account on GitHub.</em>github.com</a><a href="https://github.com/wirelessr/avroschema" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="609384dee143423a47dcf72a7c4bada5" data-thumbnail-img-id="0*W-MjsslzQogG3RGC" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*W-MjsslzQogG3RGC);"></a></div><p name="d494" id="d494" class="graf graf--p graf-after--mixtapeEmbed">The use of this go module is quite simple.</p><p name="b67a" id="b67a" class="graf graf--p graf-after--p">If we have a <code class="markup--code markup--p-code">struct</code> as follows.</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="go" name="4bea" id="4bea" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">type</span> Entity <span class="hljs-keyword">struct</span> {<br />	AStrField    <span class="hljs-type">string</span>  <span class="hljs-string">`json:&quot;a_str_field&quot;`</span><br />	AIntField    <span class="hljs-type">int</span>     <span class="hljs-string">`json:&quot;a_int_field&quot;`</span><br />	ABoolField   <span class="hljs-type">bool</span>    <span class="hljs-string">`json:&quot;a_bool_field&quot;`</span><br />	AFloatField  <span class="hljs-type">float32</span> <span class="hljs-string">`json:&quot;a_float_field&quot;`</span><br />	ADoubleField <span class="hljs-type">float64</span> <span class="hljs-string">`json:&quot;a_double_field&quot;`</span><br />}</span></pre><p name="a421" id="a421" class="graf graf--p graf-after--pre">Then just <code class="markup--code markup--p-code">import</code> the module to generate the corresponding Avro.</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="go" name="939e" id="939e" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;github.com/wirelessr/avroschema&quot;</span><br /><br />avroschema.Reflect(&amp;Entity{})</span></pre><p name="d010" id="d010" class="graf graf--p graf-after--pre">The result will be an Avro JSON.</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="json" name="6fd3" id="6fd3" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-punctuation">{</span><br />    <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Entity&quot;</span><span class="hljs-punctuation">,</span><br />    <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;record&quot;</span><span class="hljs-punctuation">,</span><br />    <span class="hljs-attr">&quot;fields&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br />      <span class="hljs-punctuation">{</span><span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;a_str_field&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;string&quot;</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span><br />      <span class="hljs-punctuation">{</span><span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;a_int_field&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;int&quot;</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span><br />      <span class="hljs-punctuation">{</span><span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;a_bool_field&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;boolean&quot;</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span><br />      <span class="hljs-punctuation">{</span><span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;a_float_field&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;float&quot;</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span><br />      <span class="hljs-punctuation">{</span><span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;a_double_field&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;double&quot;</span><span class="hljs-punctuation">}</span><br />    <span class="hljs-punctuation">]</span><br /><span class="hljs-punctuation">}</span></span></pre><p name="dd35" id="dd35" class="graf graf--p graf-after--pre">In addition, the module also supports various complex types and nested types as follows.</p><ul class="postList"><li name="5a56" id="5a56" class="graf graf--li graf-after--p"><code class="markup--code markup--li-code">array</code> and <code class="markup--code markup--li-code">slice</code></li><li name="bed5" id="bed5" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">map</code></li><li name="4422" id="4422" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">struct</code> in <code class="markup--code markup--li-code">struct</code></li><li name="3f1e" id="3f1e" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">time.Time</code></li><li name="8a47" id="8a47" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">array</code> of <code class="markup--code markup--li-code">struct</code></li><li name="af26" id="af26" class="graf graf--li graf-after--li">etc.</li></ul><p name="f17e" id="f17e" class="graf graf--p graf-after--li">Of course, the <code class="markup--code markup--p-code">omitempty</code> tag used by JSON in Golang is also supported.</p><p name="4efb" id="4efb" class="graf graf--p graf-after--p">Fields marked with <code class="markup--code markup--p-code">omitempty</code> become Avro’s union type, which is an optional field. Let’s take a more complicated example.</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="go" name="11a9" id="11a9" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">type</span> Entity <span class="hljs-keyword">struct</span> {<br />	UnionArrayField []<span class="hljs-type">int</span> <span class="hljs-string">`json:&quot;union_array_field,omitempty&quot;`</span><br />}</span></pre><p name="fd80" id="fd80" class="graf graf--p graf-after--pre">If it is an optional int array, then it will become a union type with null when converted to Avro.</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="json" name="58ce" id="58ce" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-punctuation">{</span><br />    <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Entity&quot;</span><span class="hljs-punctuation">,</span><br />    <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;record&quot;</span><span class="hljs-punctuation">,</span><br />    <span class="hljs-attr">&quot;fields&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br />      <span class="hljs-punctuation">{</span><span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;union_array_field&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;null&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-punctuation">{</span><br />        <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;array&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;items&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;int&quot;</span><br />      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">}</span><br />    <span class="hljs-punctuation">]</span><br /><span class="hljs-punctuation">}</span></span></pre><p name="ab56" id="ab56" class="graf graf--p graf-after--pre">More detailed tests can be found in the unit test file: <a href="https://github.com/wirelessr/avroschema/blob/main/reflect_test.go" data-href="https://github.com/wirelessr/avroschema/blob/main/reflect_test.go" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">reflect_test.go</a>.</p><p name="f531" id="f531" class="graf graf--p graf-after--p">However, this is not enough for us, because we need to support various special types in <code class="markup--code markup--p-code">mgm</code>, such as <code class="markup--code markup--p-code">primitive.DateTime</code> or <code class="markup--code markup--p-code">primitive.ObjectID</code>, and most especially <code class="markup--code markup--p-code">mgm.DefaultModel</code>.</p><p name="083b" id="083b" class="graf graf--p graf-after--p">Therefore, it is necessary for this module to provide customization capabilities to extend support for more special types, thus, a plugin is provided for this module to be used. To support <code class="markup--code markup--p-code">mgm</code>, you can use the already made submodule.</p><p name="e000" id="e000" class="graf graf--p graf-after--p">The following is an example of a <code class="markup--code markup--p-code">struct</code> that uses the <code class="markup--code markup--p-code">mgm</code> type.</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="go" name="8aee" id="8aee" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">type</span> Book <span class="hljs-keyword">struct</span> {<br />	mgm.DefaultModel <span class="hljs-string">`bson:&quot;,inline&quot;`</span><br />	Name             <span class="hljs-type">string</span>             <span class="hljs-string">`json:&quot;name&quot; bson:&quot;name&quot;`</span><br />	Pages            <span class="hljs-type">int</span>                <span class="hljs-string">`json:&quot;pages&quot; bson:&quot;pages&quot;`</span><br />	ObjId            primitive.ObjectID <span class="hljs-string">`json:&quot;obj_id&quot; bson:&quot;obj_id&quot;`</span><br />	ArrivedAt        primitive.DateTime <span class="hljs-string">`json:&quot;arrived_at&quot; bson:&quot;arrived_at&quot;`</span><br />	RefData          bson.M             <span class="hljs-string">`json:&quot;ref_data&quot; bson:&quot;ref_data&quot;`</span><br />	Author           []<span class="hljs-type">string</span>           <span class="hljs-string">`json:&quot;author&quot; bson:&quot;author&quot;`</span><br />}</span></pre><p name="446c" id="446c" class="graf graf--p graf-after--pre">To support these special types, you can use the built-in custom <code class="markup--code markup--p-code">MgmExtension</code>. This works just like the original <code class="markup--code markup--p-code">Reflect</code>, except it requires the use of a customized instance.</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="go" name="bec8" id="bec8" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">import</span> (<br />	<span class="hljs-string">&quot;github.com/wirelessr/avroschema&quot;</span><br />	<span class="hljs-string">&quot;github.com/wirelessr/avroschema/mongo&quot;</span><br />)<br /><br />reflector := <span class="hljs-built_in">new</span>(avroschema.Reflector)<br />reflector.Mapper = MgmExtension<br /><br />reflector.Reflect(&amp;Book{})</span></pre><p name="70ed" id="70ed" class="graf graf--p graf-after--pre">There are a couple of important points to note here.</p><ol class="postList"><li name="ac06" id="ac06" class="graf graf--li graf-after--p"><code class="markup--code markup--li-code">DefaultModel</code> is a type that directly generates three fields, <code class="markup--code markup--li-code">_id</code>, <code class="markup--code markup--li-code">created_at</code> and <code class="markup--code markup--li-code">updated_at</code>.</li><li name="a055" id="a055" class="graf graf--li graf-after--li">If <code class="markup--code markup--li-code">primitive.ObjectID</code> then it is treated as a <code class="markup--code markup--li-code">string</code>, since the UUID mentioned in <a href="https://avro.apache.org/docs/1.11.1/specification/#uuid" data-href="https://avro.apache.org/docs/1.11.1/specification/#uuid" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">Avro specification</a> is also treated as a <code class="markup--code markup--li-code">string</code>.</li><li name="f60b" id="f60b" class="graf graf--li graf-after--li">If <code class="markup--code markup--li-code">primitive.DateTime</code>, then it is treated as <code class="markup--code markup--li-code">time.Time</code>.</li><li name="ec9d" id="ec9d" class="graf graf--li graf-after--li">A special case is <code class="markup--code markup--li-code">bson.M</code>, which is treated as a JSON string because there is no way to be sure what is in it.</li></ol><p name="6e19" id="6e19" class="graf graf--p graf-after--li">According to the above rules, the final Avro schema is as follows.</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="json" name="7cc8" id="7cc8" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-punctuation">{</span><br />	<span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Book&quot;</span><span class="hljs-punctuation">,</span><br />	<span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;record&quot;</span><span class="hljs-punctuation">,</span><br />	<span class="hljs-attr">&quot;fields&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br />		<span class="hljs-punctuation">{</span> <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;_id&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;string&quot;</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span><br />		<span class="hljs-punctuation">{</span> <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;created_at&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;long&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;logicalType&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;timestamp-millis&quot;</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span><br />		<span class="hljs-punctuation">{</span> <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;updated_at&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;long&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;logicalType&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;timestamp-millis&quot;</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span><br />		<span class="hljs-punctuation">{</span> <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;name&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;string&quot;</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span><br />		<span class="hljs-punctuation">{</span> <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;pages&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;int&quot;</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span><br />		<span class="hljs-punctuation">{</span> <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;obj_id&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;string&quot;</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span><br />		<span class="hljs-punctuation">{</span> <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;arrived_at&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;long&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;logicalType&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;timestamp-millis&quot;</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span><br />		<span class="hljs-punctuation">{</span> <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ref_data&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;string&quot;</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span><br />		<span class="hljs-punctuation">{</span> <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;author&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;array&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">&quot;items&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;string&quot;</span> <span class="hljs-punctuation">}</span> <br />	<span class="hljs-punctuation">]</span><br /><span class="hljs-punctuation">}</span></span></pre><h3 name="61c1" id="61c1" class="graf graf--h3 graf-after--pre">Conclusion</h3><p name="2e92" id="2e92" class="graf graf--p graf-after--h3">When implementing the requirement to convert Golang <code class="markup--code markup--p-code">struct</code> to Avro schema I first tried to look for existing packages, but unfortunately I couldn’t find any. However, there is <a href="https://github.com/invopop/jsonschema" data-href="https://github.com/invopop/jsonschema" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">a similar project</a> that aims to convert Golang <code class="markup--code markup--p-code">struct</code> to JSON schema, so I referred to his practice and made a version of Avro schema.</p><p name="ad62" id="ad62" class="graf graf--p graf-after--p">In fact, there are still some specifications in the Avro schema that I don’t support, such as the <code class="markup--code markup--p-code">enum</code> type, and there are also many optional parameters that I don’t support because they don’t correspond to <code class="markup--code markup--p-code">struct</code>, such as <code class="markup--code markup--p-code">namespace</code>, <code class="markup--code markup--p-code">aliases</code>, etc.</p><p name="02a4" id="02a4" class="graf graf--p graf-after--p">But for now, this implementation satisfies my need for data ingest, and allows Kafka consumers to have the correct schema to work with. Maybe I’ll continue to improve this project sometime in the future so that it can really support all kinds of Avro specifications. But I have to say, in terms of functionality, it’s pretty useful right now.</p><p name="8740" id="8740" class="graf graf--p graf-after--p">The project has full unit testing and linter, and I’m sure the code structure isn’t too complicated, so feel free to contribute.</p><h3 name="99c5" id="99c5" class="graf graf--h3 graf-after--p">Stackademic</h3><p name="ce26" id="ce26" class="graf graf--p graf-after--h3">Thank you for reading until the end. Before you go:</p><ul class="postList"><li name="5864" id="5864" class="graf graf--li graf-after--p">Please consider <strong class="markup--strong markup--li-strong">clapping</strong> and <strong class="markup--strong markup--li-strong">following</strong> the writer! 👏</li><li name="0ec5" id="0ec5" class="graf graf--li graf-after--li">Follow us <a href="https://twitter.com/stackademichq" data-href="https://twitter.com/stackademichq" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">X</a> | <a href="https://www.linkedin.com/company/stackademic" data-href="https://www.linkedin.com/company/stackademic" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--li-strong">LinkedIn</strong></a><strong class="markup--strong markup--li-strong"> |</strong> <a href="https://www.youtube.com/c/stackademic" data-href="https://www.youtube.com/c/stackademic" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--li-strong">YouTube</strong></a><strong class="markup--strong markup--li-strong"> | </strong><a href="https://discord.gg/in-plain-english-709094664682340443" data-href="https://discord.gg/in-plain-english-709094664682340443" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--li-strong">Discord</strong></a></li><li name="18ce" id="18ce" class="graf graf--li graf-after--li graf--trailing">Visit our other platforms: <a href="https://plainenglish.io" data-href="https://plainenglish.io" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--li-strong">In Plain English</strong></a><strong class="markup--strong markup--li-strong"> | </strong><a href="https://cofeed.app/" data-href="https://cofeed.app/" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--li-strong">CoFeed</strong></a><strong class="markup--strong markup--li-strong"> | </strong><a href="https://venturemagazine.net/" data-href="https://venturemagazine.net/" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--li-strong">Venture</strong></a></li></ul></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@lazypro" class="p-author h-card">Chunting Wu</a> on <a href="https://medium.com/p/38cfb1b9dfbf"><time class="dt-published" datetime="2024-01-15T01:35:11.586Z">January 15, 2024</time></a>.</p><p><a href="https://medium.com/@lazypro/generating-avro-schemas-from-go-types-38cfb1b9dfbf" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on October 21, 2024.</p></footer></article></body></html>