<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Paradigm Shift in Software Development, Part 2</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Paradigm Shift in Software Development, Part 2</h1>
</header>
<section data-field="subtitle" class="p-summary">
Addressing the limitations of GenAI via REST API function calling
</section>
<section data-field="body" class="e-content">
<section name="3e61" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="d0d7" id="d0d7" class="graf graf--h3 graf--leading graf--title">Paradigm Shift in Software Development, Part 2</h3><h4 name="4dd7" id="4dd7" class="graf graf--h4 graf-after--h3 graf--subtitle">Addressing the limitations of GenAI via REST API function calling</h4><figure name="b89b" id="b89b" class="graf graf--figure graf-after--h4"><img class="graf-image" data-image-id="1*R45EJH8jQ-H4IeYMD1OB7Q.png" data-width="4032" data-height="2268" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*R45EJH8jQ-H4IeYMD1OB7Q.png"><figcaption class="imageCaption">My girl</figcaption></figure><ul class="postList"><li name="b164" id="b164" class="graf graf--li graf-after--figure"><a href="https://medium.com/@lazypro/a-paradigm-shift-in-software-development-leveraging-genai-for-direct-business-logic-processing-9929a724cc1c" data-href="https://medium.com/@lazypro/a-paradigm-shift-in-software-development-leveraging-genai-for-direct-business-logic-processing-9929a724cc1c" class="markup--anchor markup--li-anchor" rel="noopener noreferrer" target="_blank">Paradigm Shift in Software Development, Part 1</a></li><li name="5b6a" id="5b6a" class="graf graf--li graf-after--li"><a href="https://medium.com/@lazypro/paradigm-shift-in-software-development-part-2-60703d518ac9" data-href="https://medium.com/@lazypro/paradigm-shift-in-software-development-part-2-60703d518ac9" class="markup--anchor markup--li-anchor" target="_blank">Paradigm Shift in Software Development, Part 2</a></li></ul><p name="f69e" id="f69e" class="graf graf--p graf-after--li">Last time, we mentioned that GenAI can be used to implement business logic and dramatically increase development productivity and reduce the effort of debugging.</p><p name="c0cd" id="c0cd" class="graf graf--p graf-after--p">However, I have to say that GenAI is not suitable for applications that require accurate computation. In other words, the demonstration in the previous article was just a demo and not a recommendation to use GenAI for calculating promotions.</p><p name="f2fd" id="f2fd" class="graf graf--p graf-after--p">But that doesn’t mean using GenAI as a business logic is a bad idea. On the contrary, GenAI is really suitable for replacing “some” business logic.</p><p name="ffbe" id="ffbe" class="graf graf--p graf-after--p">Maybe you will ask, most of the business logic needs to be calculated and requires accuracy, so what exactly can GenAI help? Well, I’ll tell you, it helps call the APIs that have already been coded.</p><p name="98c4" id="98c4" class="graf graf--p graf-after--p">The correct way to use GenAI to handle business logic is to encapsulate that business logic directly into a Remote Procedure Call (RPC) and let GenAI prepare the parameters needed for the RPC and call the corresponding RPC correctly.</p><p name="0851" id="0851" class="graf graf--p graf-after--p">Currently, the RPC that is easiest for GenAI to handle is the REST API for the following reasons.</p><ol class="postList"><li name="8853" id="8853" class="graf graf--li graf-after--p">Plain text style, no matter the URI, HTTP header, HTTP method, query parameter and request payload are all plain text.</li><li name="93a6" id="93a6" class="graf graf--li graf-after--li">Full specification support. Nowadays, the most straightforward way to describe a REST API is to use a swagger, and the description file of the swagger is also plain text.</li><li name="10d9" id="10d9" class="graf graf--li graf-after--li">REST is a mature and relatively less dependency choice, on the contrary, such as gRPC and other protocols need to have to install additional drivers.</li></ol><p name="48b1" id="48b1" class="graf graf--p graf-after--li">Therefore it’s pretty clear what we’re going to do, so let’s follow the steps and explain them. We will still use Gemini as a demonstration as in the previous article, but once again, you can use what you are familiar with.</p><h3 name="0b98" id="0b98" class="graf graf--h3 graf-after--p">Experimental environment introduction</h3><p name="5904" id="5904" class="graf graf--p graf-after--h3">I have prepared a web service with basic CRUD.</p><p name="8570" id="8570" class="graf graf--p graf-after--p"><a href="https://github.com/wirelessr/genai_api_calling" data-href="https://github.com/wirelessr/genai_api_calling" class="markup--anchor markup--p-anchor" rel="noopener noreferrer noopener" target="_blank">https://github.com/wirelessr/genai_api_calling</a></p><p name="6e75" id="6e75" class="graf graf--p graf-after--p">Just <code class="markup--code markup--p-code">docker compose up</code> to get the service up.</p><p name="4600" id="4600" class="graf graf--p graf-after--p">This service is a product microservice that handles CRUD for a single product and saves the results in a database. For ease of use, I’m using Redis as the database for this example.</p><p name="cec2" id="cec2" class="graf graf--p graf-after--p">This service has two entry points.</p><ol class="postList"><li name="56be" id="56be" class="graf graf--li graf-after--p"><a href="http://localhost:50000/" data-href="http://localhost:50000/" class="markup--anchor markup--li-anchor" rel="noopener noreferrer" target="_blank">http://localhost:50000</a> is the home page of the microservice, with a simple list page and blocks for adding and modifying products.</li><li name="e86e" id="e86e" class="graf graf--li graf-after--li"><a href="http://localhost:50000/apidocs" data-href="http://localhost:50000/apidocs" class="markup--anchor markup--li-anchor" rel="noopener noreferrer" target="_blank">http://localhost:50000/apidocs</a> is the swagger home page, which lists all the API descriptions and specifications.</li></ol><p name="c323" id="c323" class="graf graf--p graf-after--li">Then prepare some basic test data.</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="bash" name="332f" id="332f" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">curl -X POST <span class="hljs-string">&quot;http://localhost:50000/api/product&quot;</span> -H <span class="hljs-string">&quot;accept: application/json&quot;</span> -H <span class="hljs-string">&quot;Content-Type: application/x-www-form-urlencoded&quot;</span> -d <span class="hljs-string">&quot;id=123&amp;name=Apple&amp;description=Fruit&quot;</span><br />curl -X POST <span class="hljs-string">&quot;http://localhost:50000/api/product&quot;</span> -H <span class="hljs-string">&quot;accept: application/json&quot;</span> -H <span class="hljs-string">&quot;Content-Type: application/x-www-form-urlencoded&quot;</span> -d <span class="hljs-string">&quot;id=234&amp;name=Bird&amp;description=Animal&quot;</span><br />curl -X POST <span class="hljs-string">&quot;http://localhost:50000/api/product&quot;</span> -H <span class="hljs-string">&quot;accept: application/json&quot;</span> -H <span class="hljs-string">&quot;Content-Type: application/x-www-form-urlencoded&quot;</span> -d <span class="hljs-string">&quot;id=345&amp;name=Cat&amp;description=Animal&quot;</span></span></pre><p name="279a" id="279a" class="graf graf--p graf-after--pre">It is worth noting that creating a new product and modifying a product are actually the same API: <code class="markup--code markup--p-code">POST /api/product</code>. When the product ID doesn&#39;t exist, the API will create a new product; on the other hand, if the product ID exists, then it will modify the product.</p><p name="a639" id="a639" class="graf graf--p graf-after--p">Remember this, because it’s relevant to the business logic we’re trying to implement.</p><p name="510b" id="510b" class="graf graf--p graf-after--p">The following examples are actually listed in <a href="https://github.com/wirelessr/genai_api_calling/blob/main/rest_api_calling.ipynb" data-href="https://github.com/wirelessr/genai_api_calling/blob/main/rest_api_calling.ipynb" class="markup--anchor markup--p-anchor" rel="noopener noreferrer noopener" target="_blank">rest_api_calling.ipynb</a>.</p><h3 name="7074" id="7074" class="graf graf--h3 graf-after--p">GenAI calls RPC</h3><p name="bdc4" id="bdc4" class="graf graf--p graf-after--h3">First, we need to enable GenAI to call RPCs, which is called function calling, and both OpenAI’s ChatGPT and Google’s Gemini have similar capabilities.</p><p name="c5fe" id="c5fe" class="graf graf--p graf-after--p">Reference links are listed here.</p><ul class="postList"><li name="7f41" id="7f41" class="graf graf--li graf-after--p"><a href="https://platform.openai.com/docs/guides/function-calling" data-href="https://platform.openai.com/docs/guides/function-calling" class="markup--anchor markup--li-anchor" rel="noopener noreferrer noopener" target="_blank">ChatGPT function calling</a></li><li name="73fe" id="73fe" class="graf graf--li graf-after--li"><a href="https://ai.google.dev/gemini-api/docs/function-calling" data-href="https://ai.google.dev/gemini-api/docs/function-calling" class="markup--anchor markup--li-anchor" rel="noopener noreferrer noopener" target="_blank">Gemini function calling</a></li></ul><p name="9ad1" id="9ad1" class="graf graf--p graf-after--li">The following is an example.</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="rust" name="63f2" id="63f2" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">def <span class="hljs-title function_ invoke__">get_website_content</span>(url: <span class="hljs-type">str</span>) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-type">str</span>:<br />  <span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;<br />  Get the content from a specific URL similar to curl -X GET.Args.<br />      url (str, required): The target URL is either remote or local.<br />  Returns.<br />      str: The raw content from a specific URL.<br />  &quot;</span><span class="hljs-string">&quot;&quot;</span><br />  response = requests.<span class="hljs-title function_ invoke__">get</span>(url)<br />  <span class="hljs-keyword">return</span> response.text<br /><br />def <span class="hljs-title function_ invoke__">post_request</span>(url: <span class="hljs-type">str</span>, data: <span class="hljs-type">str</span>) <span class="hljs-punctuation">-&gt;</span> dict:<br />  <span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;<br />  Send a request similar to curl -X POST.<br />  Args.<br />      url (str, required): Target URL.<br />      data (str, required): The data of the form in &quot;</span>id=value1&amp;name=value2&amp;description=value3<span class="hljs-string">&quot; format.<br />  Returns.<br />      dict: Dictionary containing the status code and response content.<br />  &quot;</span><span class="hljs-string">&quot;&quot;</span><br />  response = requests.<span class="hljs-title function_ invoke__">post</span>(url, headers={<span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/x-www-form-urlencoded&quot;</span>}, data=data)<br />  <span class="hljs-keyword">try</span>:<br />      response_content = response.<span class="hljs-title function_ invoke__">json</span>()<br />  except ValueError:<br />      response_content = response.text<br />  <span class="hljs-keyword">return</span> {<br />      <span class="hljs-string">&quot;status_code&quot;</span>: response.status_code,<br />      <span class="hljs-string">&quot;content&quot;</span>: response_content,<br />  }<br /><br />system_instruction = <span class="hljs-string">&#x27;&#x27;&#x27;</span>You are a professional web crawler and familiar with swagger usage.<br />You can get the content you want by yourself through web api, <br />and when you utilize web api, you will actively list which api is used.<br />If you don<span class="hljs-symbol">&#x27;t</span> know the answer to a question, just answer no, don<span class="hljs-symbol">&#x27;t</span> make up an answer.<br /><span class="hljs-string">&#x27;&#x27;&#x27;</span><br /><br />model = genai.<span class="hljs-title function_ invoke__">GenerativeModel</span>(model_name=<span class="hljs-symbol">&#x27;gemini</span>-<span class="hljs-number">1.5</span>-pro&#x27;,<br />                              tools=[get_website_content, post_request],<br />                              system_instruction=system_instruction,)</span></pre><p name="c441" id="c441" class="graf graf--p graf-after--pre">We have designed two tools for Gemini, <code class="markup--code markup--p-code">get_website_content</code> and <code class="markup--code markup--p-code">post_request</code>. The code comments and annotations must be written in detail so that GenAI can realize the use of these tools.</p><p name="2a11" id="2a11" class="graf graf--p graf-after--p">Now GenAI can use <code class="markup--code markup--p-code">GET</code> and <code class="markup--code markup--p-code">POST</code>.</p><h3 name="48ff" id="48ff" class="graf graf--h3 graf-after--p">GenAI understands RPC specifications</h3><p name="d247" id="d247" class="graf graf--p graf-after--h3">Once GenAI is able to invoke RPC, we then need to enable GenAI to learn “all” RPC specifications.</p><p name="624d" id="624d" class="graf graf--p graf-after--p">In the case of REST APIs, the simplest way is to use a swagger to describe all the APIs, including their inputs and outputs, as well as their functionality. The more detailed the information, the more GenAI can operate correctly without having to spend a lot of effort tuning prompts.</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="python" name="f25e" id="f25e" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">chat_session = model.start_chat(<br />    enable_automatic_function_calling=<span class="hljs-literal">True</span>,<br />    history=[<br />        {<br />            <span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;user&quot;</span>,<br />            <span class="hljs-string">&quot;parts&quot;</span>: [<br />                <span class="hljs-string">&quot;I have a website and this website provides full swagger: http://localhost:50000/apispec_1.json Please tell me the features of this website.&quot;</span><br />            ]<br />        },<br />        {<br />            <span class="hljs-string">&quot;role&quot;</span>: <span class="hljs-string">&quot;model&quot;</span>,<br />            <span class="hljs-string">&quot;parts&quot;</span>: [<br />                <span class="hljs-string">&quot;&quot;&quot;This website provides four API endpoints:- Create or update a product: You can send a POST request to `/api/product` with product ID, name, and description to create or update a product.<br />- Delete a product: You can send a POST request to `/api/product/delete/{product_id}` to delete a product by its ID.<br />- Get a product: You can send a GET request to `/api/product/{product_id}` to retrieve the details of a product by its ID.<br />- Get all products: You can send a GET request to `/api/products` to get a list of all products. &quot;&quot;&quot;</span><br />            ]<br />        }<br />    ]<br />)<br /><br /></span></pre><p name="2463" id="2463" class="graf graf--p graf-after--pre">This is the record I left after talking to Gemini beforehand, it can be used as the history of the prompt.</p><p name="af57" id="af57" class="graf graf--p graf-after--p">You can also do some additional conversations to verify that Gemini has really learned it.</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="python" name="b3d4" id="b3d4" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">response = chat_session.send_message(<span class="hljs-string">&quot;Create a new product by your own thought&quot;</span>)<br /><br /><span class="hljs-built_in">print</span>(response.text)</span></pre><h3 name="c973" id="c973" class="graf graf--h3 graf-after--pre">Practical Business Logic</h3><p name="77e1" id="77e1" class="graf graf--p graf-after--h3">Now we’ve made sure that GenAI knows the basics, we can make GenAI implement business logic based on those basics.</p><p name="d102" id="d102" class="graf graf--p graf-after--p">For example, the current <code class="markup--code markup--p-code">POST /api/product</code> is a combination of creation and modification, with the <code class="markup--code markup--p-code">id</code> determining whether to create or modify. The <code class="markup--code markup--p-code">id</code> is filled in by the client itself, so it is very likely to be wrong.</p><p name="1b2a" id="1b2a" class="graf graf--p graf-after--p">Then we can ask GenAI to find out the unused <code class="markup--code markup--p-code">id</code> to add based on the result of <code class="markup--code markup--p-code">list</code>.</p><blockquote name="9e57" id="9e57" class="graf graf--blockquote graf-after--p"><em class="markup--em markup--blockquote-em">Avoid the existing ids and create a new product.</em></blockquote><p name="0675" id="0675" class="graf graf--p graf-after--blockquote">In this way, the client does not need to fill in the <code class="markup--code markup--p-code">id</code> itself but GenAI is responsible for generating the <code class="markup--code markup--p-code">id</code>.</p><p name="b892" id="b892" class="graf graf--p graf-after--p">Or another use case, right now the <code class="markup--code markup--p-code">description</code> is free format, so it can be written any way we want. But we can use GenAI to provide a template so that all creations and modifications are in a fixed format, such as the following template.</p><blockquote name="296a" id="296a" class="graf graf--blockquote graf-after--p">When creating and modifying products, the description must conform to the following format.</blockquote><blockquote name="658e" id="658e" class="graf graf--blockquote graf-after--blockquote">- Category: str, the category of the product.</blockquote><blockquote name="1394" id="1394" class="graf graf--blockquote graf-after--blockquote">- Price: int, the price of the product.</blockquote><blockquote name="eae7" id="eae7" class="graf graf--blockquote graf-after--blockquote">- Notes: str, additional information.</blockquote><p name="5d1d" id="5d1d" class="graf graf--p graf-after--blockquote">The implementation of this business logic doesn’t involve computation, it’s just a matter of letting GenAI call on a known API to accomplish a specific goal.</p><p name="8293" id="8293" class="graf graf--p graf-after--p">You can use your imagination to make more variations.</p><h3 name="12de" id="12de" class="graf graf--h3 graf-after--p">Conclusion</h3><p name="a768" id="a768" class="graf graf--p graf-after--h3">In the previous article we mentioned that GenAI can be used to implement business logic, and this is true. But in practice, we still need to do some development work to make GenAI able to implement business logic accurately.</p><p name="d877" id="d877" class="graf graf--p graf-after--p">Because GenAI may be good at business logic, but it’s not accurate, so in order to maximize GenAI’s strengths, we need to make GenAI do as little computation as possible. By encapsulating the business logic that needs to be computed and enabling GenAI to execute it exactly according to the instructions we provide, we can maximize productivity.</p><p name="fd83" id="fd83" class="graf graf--p graf-after--p">Why do we use GenAI to implement business logic?</p><p name="9696" id="9696" class="graf graf--p graf-after--p">Let’s go back and answer this fundamental question. Because GenAI has the ability to understand natural language and execute our predefined scripts or steps, implementing business logic with GenAI becomes software development in natural language.</p><p name="0ecf" id="0ecf" class="graf graf--p graf-after--p">Of course, GenAI is not perfect, there are a few core concepts in the development process.</p><ol class="postList"><li name="01ae" id="01ae" class="graf graf--li graf-after--p">Integration must be done properly. Although the examples I have provided are all working scripts, in fact, to make GenAI actually put into production environment requires a lot of infrastructure. For example, LLM caching, vector databases, and model repository. Each of these components is a new tech stack for organizations that have never introduced GenAI before.</li><li name="3251" id="3251" class="graf graf--li graf-after--li">Prompts must be good. Although we are developing in natural language, GenAI can easily “learn the wrong way” if we are not precise enough. Moreover, GenAI may perform normally but crash when it encounters a specific pattern, which will be very difficult to debug.</li><li name="3de8" id="3de8" class="graf graf--li graf-after--li">Testing must be done right. We have already encapsulated business logic into RPC for GenAI, but we still need to make sure that GenAI works properly in all kinds of scenarios, so we must have a high coverage of test cases.</li></ol><p name="6f6d" id="6f6d" class="graf graf--p graf-after--li graf--trailing">As we can see, although software development with GenAI may seem attractive, there are many challenges that must be overcome. If we want to become a master of prompting, we still have to be a developer first.</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@lazypro" class="p-author h-card">Chunting Wu</a> on <a href="https://medium.com/p/60703d518ac9"><time class="dt-published" datetime="2024-07-29T01:50:57.965Z">July 29, 2024</time></a>.</p><p><a href="https://medium.com/@lazypro/paradigm-shift-in-software-development-part-2-60703d518ac9" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on October 21, 2024.</p></footer></article></body></html>