<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Trunk-based Development Can Help</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Trunk-based Development Can Help</h1>
</header>
<section data-field="subtitle" class="p-summary">
We can regard trunk-based development as a holy grail of the software development. You must have many good practices in order to drive…
</section>
<section data-field="body" class="e-content">
<section name="906f" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="4c99" id="4c99" class="graf graf--h3 graf--leading graf--title">Trunk-based Development Can Help</h3><p name="dffb" id="dffb" class="graf graf--p graf-after--h3"><a href="https://www.amazon.com/DevOps-Handbook-World-Class-Reliability-Organizations/dp/1942788002" data-href="https://www.amazon.com/DevOps-Handbook-World-Class-Reliability-Organizations/dp/1942788002" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">The DevOps Handbook</a> tells using trunk-based development can improve the efficiency of developing software. Thus, what is the magic of trunk-based development make us to abandon our familiar git-related workflow?</p><h3 name="977c" id="977c" class="graf graf--h3 graf-after--p">Git workflow</h3><p name="4bea" id="4bea" class="graf graf--p graf-after--h3">It should start from the git-related workflow. Whether it is <code class="markup--code markup--p-code">git workflow</code>, <code class="markup--code markup--p-code">github workflow</code> or even <code class="markup--code markup--p-code">gitlab workflow</code>, in general, the entire development process is completed by using feature branches, development branches, and main branches. However, from this point of view, we find that to complete a feature development, at least three branches are involved. Each branch have to be merged into another branch. In addition to resolving conflicts during the merge, when to merge is also important.</p><p name="69e1" id="69e1" class="graf graf--p graf-after--p">Engineers in the same team must be fully aware of the status of each branch, which not only brings cognitive load, but also brings management troubles. Besides, when many major functions are developed, the online code base will be very different from the code under development. Therefore, these several workflows tell us to divide a feature into some small changes and continue to integrate them.</p><figure name="4935" id="4935" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="0*sxES7Oh9Mmn0G3Tg.png" data-width="528" data-height="700" src="https://cdn-images-1.medium.com/max/800/0*sxES7Oh9Mmn0G3Tg.png"><figcaption class="imageCaption"><a href="https://docs.gitlab.com/ee/topics/gitlab_flow.html" data-href="https://docs.gitlab.com/ee/topics/gitlab_flow.html" class="markup--anchor markup--figure-anchor" rel="nofollow noopener" target="_blank">https://docs.gitlab.com/ee/topics/gitlab_flow.html</a></figcaption></figure><p name="8767" id="8767" class="graf graf--p graf-after--figure">The above figure is a typical <code class="markup--code markup--p-code">gitlab workflow</code>. It is not difficult to see that it is very complicated. There are many interactions between various branches, and there are many rules to be followed. Of course, with these rules, comes many restrictions.</p><h3 name="fe9d" id="fe9d" class="graf graf--h3 graf-after--p">Trunk-based workflow</h3><p name="7113" id="7113" class="graf graf--p graf-after--h3"><a href="https://www.amazon.com/Extreme-Programming-Explained-Embrace-Change/dp/0321278658" data-href="https://www.amazon.com/Extreme-Programming-Explained-Embrace-Change/dp/0321278658" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Extreme Programming Explained</a> advocates getting feedback as soon as possible. Instead of testing slowly in the test environment and staging environment, it is better to go directly to the production to receive faster results. Since git-related workflows have already suggested small changes and continuous integration, why not just take away those branches with many management burdens, leaving only one branch: the main branch?</p><blockquote name="55be" id="55be" class="graf graf--blockquote graf-after--p"><em class="markup--em markup--blockquote-em">This is the spirit of trunk-based development. There is only one trunk branch. All features are branched from this branch and continuously merged back into the trunk. The online environment is based on this trunk branch and is the continuous deployment.</em></blockquote><p name="c7af" id="c7af" class="graf graf--p graf-after--blockquote">In fact, there are many problems to be executed in this most ideal way. After all, no one wants to destroy the formal environment because of a small change, so there are still various test environments. At this time, it is still necessary to have a mechanism to correspond the trunk to each test environment. In practice, the most commonly used method that will not violate the spirit of trunk-based is to use tags on the trunk branch to identify the version. If there are urgent bugs that must be dealt with, a hotfix branch must still be generated from the tag. Nevertheless, unlike git workflow, this hotfix branch that belongs to a specific tag has its life cycle. When the next tag is released in the environment that originally used this tag, this hotfix branch should be eliminated.</p><p name="ee51" id="ee51" class="graf graf--p graf-after--p">Therefore, although there will be release branches or hotfix branches that branch from the main trunk, these two types of branches will not return to the main trunk. In other words, all fixes first enter the main branch and then enter the hotfix branch through cherry-pick. This produces a benefit, the environment that is released after the hotfix can immediately receive the effects of the hotfix.</p><p name="4bae" id="4bae" class="graf graf--p graf-after--p">The workflow is as follows.</p><figure name="76e3" id="76e3" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="0*a5-Ie5Oiz7ziJRKw.png" data-width="509" data-height="355" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/0*a5-Ie5Oiz7ziJRKw.png"></figure><h3 name="a074" id="a074" class="graf graf--h3 graf-after--figure">Conclusion</h3><p name="1036" id="1036" class="graf graf--p graf-after--h3">In order to drive this development process well, we must have some “good” practices, and the most frequently mentioned is the feature toggle. Because all submitted pieces have to enter the main trunk and will be released at any time, it is necessary to be able to isolate and conditionally control the testing scope for unprepared code. Feature toggle benefits this need.</p><p name="97ae" id="97ae" class="graf graf--p graf-after--p">On the other hand, if it is a very efficient development team, there is no need to have a release branch or a hotfix branch, i.e., online problems can be solved in a forward fix. That is to say the entire software system must have complete telemetries and monitoring systems to find out the online defects faster.</p><p name="fec8" id="fec8" class="graf graf--p graf-after--p">All these good practices are described in The DevOps Handbook, so I really recommend this book.</p><p name="3fe0" id="3fe0" class="graf graf--p graf-after--p">We can regard trunk-based development as the holy grail of the software development. You must have many good practices in order to be able to use well. Once applying the trunk-based development, it will not only reduce the complexities of managing branches and environments but also reduce the overhead of every engineer, e.g., merging.</p><p name="c9b9" id="c9b9" class="graf graf--p graf-after--p graf--trailing">Recently, I guide my team to introduce the feature toggle, and my team members begin to experience the benefits of trunk-based development. For a two-pizza team, it can indeed greatly increase the productivity.</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@lazypro" class="p-author h-card">Chunting Wu</a> on <a href="https://medium.com/p/4bb425595c00"><time class="dt-published" datetime="2021-11-11T05:53:47.304Z">November 11, 2021</time></a>.</p><p><a href="https://medium.com/@lazypro/trunk-based-development-can-help-4bb425595c00" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on October 21, 2024.</p></footer></article></body></html>